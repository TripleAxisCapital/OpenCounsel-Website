<!DOCTYPE html>
<html lang="en" class="scroll-smooth" data-theme="auto">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>OC-News — The AI Workspace. Without Limits.</title>
  <meta name="theme-color" content="#000000" />
  <link rel="icon" href="logo.svg" type="image/svg+xml" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['Inter','ui-sans-serif','system-ui','SF Pro Text','Segoe UI','Roboto','Apple Color Emoji','Helvetica Neue','Arial','Noto Color Emoji','sans-serif'] },
          boxShadow: { 'oc-soft': '0 8px 24px -10px rgba(0,0,0,0.35)' },
          keyframes: {
            'pulse-soft': { '0%,100%': { opacity: .65 }, '50%': { opacity: 1 } },
            'ticker': { '0%': { transform: 'translateX(0)' }, '100%': { transform: 'translateX(-50%)' } },
            'progress': { '0%': { transform: 'translateX(-100%)' }, '100%': { transform: 'translateX(100%)' } },
            'shine': { '0%': { backgroundPosition: '-200% 0' }, '100%': { backgroundPosition: '200% 0' } },
            'fade-in': { '0%': { opacity: 0 }, '100%': { opacity: 1 } },
            'fade-out': { '0%': { opacity: 1 }, '100%': { opacity: 0 } }
          },
          animation: {
            'pulse-soft': 'pulse-soft 3.6s ease-in-out infinite',
            'ticker': 'ticker 18s linear infinite',
            'progress': 'progress 1.1s ease-in-out infinite',
            'shine': 'shine 1.8s ease-in-out infinite',
            'fade-in': 'fade-in .45s ease forwards',
            'fade-out': 'fade-out .45s ease forwards'
          }
        }
      }
    }
  </script>
  <style>
    :root{
      --logo-size:34px;--logo-size-lg:40px;
      --radius:14px;
      --bg:#0b0b0c;--surface:#000;--border:rgba(255,255,255,0.12);
      --text:#f5f7fb;--sub:#a6acb8;--accent:#356dff;--live:#ff3b30;
      --chip:rgba(255,255,255,0.06);--chip-border:rgba(255,255,255,0.12);
      --card-hover:rgba(255,255,255,0.06);
      --header-h:60px;
      --preload-bg:#fff; --preload-text:#000;
    }
    html.light{
      --bg:#fff;--surface:#fff;--border:rgba(5,13,38,0.10);
      --text:#0b0b0e;--sub:#5a6274;--card-hover:rgba(0,0,0,0.045);
    }
    .card{ background:var(--surface); border:1px solid var(--border); border-radius:var(--radius) }
    .chip{ background:var(--chip); border:1px solid var(--chip-border) }
    .btn{ background:transparent; border:0 } .btn:hover{ background:var(--card-hover) }
    .btn:focus{ outline:0 } .btn:focus-visible{ box-shadow:0 0 0 2px color-mix(in oklab,var(--accent) 38%,transparent); border-radius:10px }
    .link-btn{ border:0; background:transparent; padding:6px 8px; color:var(--sub); border-radius:8px }
    .link-btn:hover{ color:var(--text) }
    .hairline{ height:1px; background:var(--border) }
    .section-lead{ font-weight:800; letter-spacing:-.02em; font-size:clamp(28px,8vw,48px); color:var(--live) }
    .hero-section-container{ padding-block:1.1rem } @media (min-width:640px){ .hero-section-container{ padding-block:1.6rem } }
    #heroCard{ min-height:58svh; display:flex; flex-direction:column; overflow:hidden }
    .hero-media{ position:relative; border-radius:12px; overflow:hidden; border:1px solid var(--border); flex:1 }
    .hero-track{ display:flex; height:100%; overflow-x:auto; scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch }
    .hero-slide{ position:relative; flex:0 0 100%; height:100%; scroll-snap-align:center }
    .hero-slide a{ position:absolute; inset:0; display:block }
    .hero-slide img{ width:100%; height:100%; object-fit:cover; display:block }
    .hero-overlay-text{ position:absolute; inset-inline:16px; bottom:14px; display:grid; gap:6px; pointer-events:none; z-index:2 }
    .hero-glass{ display:inline-block; max-width:min(92%,860px); padding:10px 12px; border-radius:14px; color:#fff; background:linear-gradient(180deg,rgba(0,0,0,.45),rgba(0,0,0,.55)); backdrop-filter:blur(10px) saturate(1.15); border:1px solid rgba(255,255,255,.14) }
    .hero-overlay-text .k{ font-size:10px; letter-spacing:.08em; text-transform:uppercase; opacity:.9 }
    .hero-overlay-text h2{ font-size:clamp(18px,3.4vw,28px); line-height:1.12; font-weight:800; letter-spacing:-.015em }
    .hero-dots{ position:absolute; bottom:12px; left:50%; transform:translateX(-50%); display:flex; gap:10px; z-index:3; pointer-events:none }
    .hero-dots span{ height:4px; width:10px; border-radius:999px; background:rgba(255,255,255,.45); border:1px solid rgba(255,255,255,.25); transition:width .25s, opacity .25s }
    .hero-dots span.active{ width:18px; background:#fff; opacity:1 }
    html.light .hero-dots span{ background:rgba(0,0,0,.3); border-color:rgba(0,0,0,.18) } html.light .hero-dots span.active{ background:#000 }
    @media (max-width:639.98px){ .hero-section-container{ padding:0!important } #heroCard,.hero-media{ border-radius:0!important; border:none!important } .hero-media{ height:54svh } }
    .tile-img{ width:100%; object-fit:cover; border:1px solid var(--border); border-radius:12px }
    /* search */
    #searchSheet{ position:fixed; inset-inline:0; top:var(--header-h); z-index:50; border-bottom:1px solid var(--border); background:color-mix(in oklab, var(--surface) 92%, transparent); backdrop-filter:blur(14px) }
    .search-field{ width:100%; border:0; border-radius:12px; background:transparent; padding:10px 36px 10px 34px; font-size:14px }
    .search-icon{ position:absolute; left:12px; top:50%; transform:translateY(-50%); opacity:.7 }
    .search-kbd{ position:absolute; right:10px; top:50%; transform:translateY(-50%); font-size:10px; color:var(--sub) }
    /* preloader */
    #preload{ position:fixed; inset:0; z-index:70; display:grid; place-items:center; background:var(--preload-bg) }
    body.preloading{ overflow:hidden } .preload-wrap{ display:grid; gap:14px; place-items:center; text-align:center; padding:24px; color:var(--preload-text) }
    .preload-spinner{ width:28px; height:28px; border-radius:999px; border:2px solid rgba(0,0,0,.15); border-top-color:#000; animation:spin 1s linear infinite }
    @keyframes spin{ to{ transform:rotate(360deg) } }
  </style>
</head>
<body class="bg-[var(--bg)] text-[var(--text)] antialiased selection:bg-[var(--accent)]/20 selection:text-[var(--text)] preloading hero-immersive">
<div id="preload"><div class="preload-wrap"><div class="preload-spinner"></div><div id="preloadLine" class="preload-line" style="font-weight:700; font-size:1.25rem; letter-spacing:-0.01em; margin-top:32px;">OC-News</div></div></div>

<header class="border-b border-[var(--border)]">
  <div class="mx-auto max-w-7xl px-3 sm:px-6 lg:px-8 py-2">
    <div class="flex items-center gap-2 sm:gap-3 justify-between">
      <div class="flex items-center gap-2 min-w-0 shrink-0">
        <a href="index.html" aria-label="Home"><img src="logo.svg" class="h-9 sm:h-10 dark:invert" alt=""></a>
        <div class="hidden sm:block text-sm text-[var(--sub)] truncate">The AI Workspace. Without Limits.</div>
      </div>
      <div class="flex items-center gap-2 sm:gap-3">
        <div class="seg overflow-x-auto no-scrollbar max-w-[46vw] sm:hidden flex-nowrap shrink">
          <button class="seg-btn" data-ed="ALL">All</button>
          <button class="seg-btn" data-ed="GLOBAL">Global</button>
          <button class="seg-btn" data-ed="US">US</button>
          <button class="seg-btn" data-ed="CA">Canada</button>
          <button class="seg-btn" data-ed="FIN">Financial</button>
        </div>
        <div class="hidden sm:flex items-center gap-2">
          <span class="hidden md:inline text-sm text-[var(--sub)]">Edition:</span>
          <select id="editionSelect" class="btn text-sm rounded-lg px-2.5 py-1.5 bg-transparent">
            <option value="ALL">All</option><option value="CA">Canada</option><option value="US">United States</option><option value="GLOBAL">Global Mix</option><option value="FIN">Financial</option>
          </select>
        </div>
        <button id="searchToggle" class="link-btn shrink-0" title="Search (/)">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="11" cy="11" r="7"/><path d="M21 21l-4.3-4.3"/></svg>
        </button>
        <button id="themeBtn" class="link-btn shrink-0" title="Toggle theme (T)">
          <svg id="sun" class="size-4 hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="4" /><path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2m16 0h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"/></svg>
          <svg id="moon" class="size-4 hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 12.79A9 9 0 1111.21 3a7 7 0 009.79 9.79z"/></svg>
        </button>
      </div>
    </div>
  </div>
</header>

<!-- Search sheet -->
<div id="searchSheet" class="hidden">
  <div class="mx-auto max-w-7xl px-3 sm:px-6 lg:px-8 py-3">
    <div class="relative">
      <span class="search-icon"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="11" cy="11" r="7"/><path d="M21 21l-4.3-4.3"/></svg></span>
      <input id="searchField" class="search-field" placeholder="Search headlines…" autocomplete="off" />
      <kbd class="search-kbd">Esc</kbd>
    </div>
  </div>
</div>

<main id="newsMain">
  <section class="relative">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 hero-section-container">
      <h1 class="section-lead mb-3 sm:mb-4">Top Stories</h1>

      <!-- BIG hero card -->
      <div id="heroCard" class="card shadow-oc-soft p-0 relative overflow-hidden">
        <figure id="heroMedia" class="hero-media">
          <div id="heroTrack" class="hero-track no-scrollbar"></div>
          <div id="heroDots" class="hero-dots"></div>
        </figure>
        <div class="px-4 sm:px-0">
          <div class="mt-3 sm:mt-4 flex items-center gap-3">
            <span id="updatedAt" class="ml-auto text-xs text-[var(--sub)]">—</span>
          </div>
          <div class="mt-4 sm:mt-6 overflow-hidden">
            <div id="ticker" class="flex gap-2 min-w-[200%] whitespace-nowrap animate-ticker"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FEED: 2 tall verticals side-by-side on mobile, then full-width horizontal cards -->
  <section class="relative">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 pt-4 pb-2">
      <!-- NOTE: grid is 2 columns by default (mobile). -->
      <ul id="newsList" class="grid grid-cols-2 gap-3 sm:gap-4 auto-rows-auto"></ul>
    </div>
    <div class="hairline"></div>
  </section>
</main>

<!-- (Weather, Trends, etc. keep your previous blocks — omitted here for brevity if you don’t need them) -->

<script>
  /* ===== essentials kept from your previous file (feeds, parsing, theme, etc.) ===== */
  const DEFAULT_EDITION='CA', MAX_ITEMS=64, SHOW_IMAGES=true, HERO_SLIDES=10, DOT_COUNT=6;
  const FEEDS={ CA:['https://news.google.com/rss?hl=en-CA&gl=CA&ceid=CA:en','https://feeds.bbci.co.uk/news/rss.xml','https://feeds.reuters.com/reuters/topNews','https://feeds.reuters.com/reuters/worldNews','https://rss.cnn.com/rss/cnn_topstories.rss','https://www.theguardian.com/world/rss','https://www.aljazeera.com/xml/rss/all.xml','https://apnews.com/hub/ap-top-news?utm_source=ap_rss&utm_medium=rss&utm_campaign=ap_top_news','https://www.cbc.ca/cmlink/rss-topstories','https://www.ctvnews.ca/rss/ctvnews-ca-top-stories-public-rss-1.822009','https://globalnews.ca/feed/','https://www.nationalpost.com/feed/'] };
  const feedsFor=e=>FEEDS[e]||FEEDS.CA;
  const $=s=>document.querySelector(s); const $$=s=>Array.from(document.querySelectorAll(s));
  const hostname=u=>{try{return new URL(u).hostname.replace(/^www\./,'')}catch{return''}};
  const cleanLink=u=>{try{const x=new URL(u);const w=x.searchParams.get('url')||x.searchParams.get('u');return w?decodeURIComponent(w):u}catch{return u}};
  const upscale=u=>{try{const x=new URL(u);['w','width','maxwidth','px','imgw'].forEach(k=>x.searchParams.has(k)&&x.searchParams.set(k,'1600'));return x.toString()}catch{return u}};
  const timeAgo=d=>{const n=new Date(),s=Math.floor((n-d)/1e3);if(s<45)return`${s}s ago`;const m=Math.floor(s/60);if(m<60)return`${m}m ago`;const h=Math.floor(m/60);if(h<24)return`${h}h ago`;return`${Math.floor(h/24)}d ago`};

  const proxyCandidates=u=>[`https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`,`https://r.jina.ai/http/${u.replace(/^https?:\/\//,'')}`];
  const fetchWithProxies=async u=>{for(const p of proxyCandidates(u)){try{const r=await fetch(p,{cache:'no-store'});if(!r.ok)continue;const t=await r.text();if(t?.length>40)return t}catch{}}throw new Error('proxy fail')};
  const parseRSS=t=>{const d=new DOMParser().parseFromString(t,'text/xml');const items=[];d.querySelectorAll('item').forEach(it=>{const title=it.querySelector('title')?.textContent||'';let link=cleanLink(it.querySelector('link')?.textContent||'');const pub=it.querySelector('pubDate')?.textContent||'';const src=it.querySelector('source')?.textContent||hostname(link);const img=it.querySelector('media\\:content')?.getAttribute('url')||it.querySelector('enclosure')?.getAttribute('url')||'';items.push({title,link,pubDate:pub?new Date(pub):new Date(),source:src,image:img});});return items};

  const heroTrack=$('#heroTrack'),heroDots=$('#heroDots'),newsList=$('#newsList'),ticker=$('#ticker'),updatedAt=$('#updatedAt');
  let currentEdition=DEFAULT_EDITION, cacheItems=[], filteredItems=[];

  const buildHeroSlides=items=>{
    const list=items.slice(0,Math.min(HERO_SLIDES,items.length));
    heroTrack.innerHTML=list.map((it,idx)=>{
      const src=(SHOW_IMAGES && it.image)?upscale(it.image):'';
      const label=it.source||hostname(it.link);
      const safe=it.title.replace(/</g,'&lt;').replace(/>/g,'&gt;');
      return `
        <div class="hero-slide">
          <a href="${it.link}" target="_blank" rel="noopener"></a>
          ${src?`<img ${idx===0?'fetchpriority="high" loading="eager"':'loading="lazy"'} src="${src}" alt="${label}">`:''}
          <div class="hero-overlay-text">
            <div class="hero-glass">
              <div class="k">${label} • ${timeAgo(it.pubDate)}</div>
              <h2>${safe}</h2>
            </div>
          </div>
        </div>`;
    }).join('');
    const dcount=Math.min(DOT_COUNT,Math.max(1,list.length));
    heroDots.innerHTML=Array.from({length:dcount}).map((_,i)=>`<span class="${i===0?'active':''}"></span>`).join('');
  };

  const renderTicker=items=>{
    ticker.innerHTML=(items.slice(0,24).map(it=>`<span class="chip rounded-full px-2.5 py-1 text-[11px] mr-2">${it.source||hostname(it.link)}: ${it.title.replace(/</g,'&lt;').replace(/>/g,'&gt;')}</span>`).join('')||'')+ticker.innerHTML;
  };

  const render=items=>{
    if(!items.length){newsList.innerHTML='';return}
    buildHeroSlides(items); updatedAt.textContent=`Updated ${new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}`; renderTicker(items);

    const tiles=items.slice(1,20);
    let html='';
    tiles.forEach((it,idx)=>{
      const src=it.source||hostname(it.link); const when=timeAgo(it.pubDate);
      const img=(it.image?`<img src="${upscale(it.image)}" alt="" class="tile-img w-full h-[260px] sm:h-[360px] object-cover">`:'');

      if(idx<2){
        /* two tall verticals — each spans 1 col so they sit side-by-side on mobile */
        html+=`
          <li class="col-span-1">
            <article class="card overflow-hidden">
              <a href="${it.link}" target="_blank" rel="noopener" class="block">${img}</a>
              <div class="p-3 sm:p-4">
                <div class="flex items-center justify-between gap-3 text-[11px] text-[var(--sub)] mb-1">
                  <span>${src}</span><span>${when}</span>
                </div>
                <a href="${it.link}" target="_blank" rel="noopener" class="block">
                  <h3 class="text-base sm:text-lg font-extrabold leading-snug">${it.title}</h3>
                </a>
              </div>
            </article>
          </li>`;
      }else{
        /* subsequent items — full-width horizontal cards on mobile too */
        html+=`
          <li class="col-span-2">
            <article class="card p-3 sm:p-4 flex items-stretch gap-3 sm:gap-4">
              <div class="flex-1 min-w-0">
                <div class="flex items-center justify-between gap-3 text-[11px] text-[var(--sub)] mb-1">
                  <span>${src}</span><span>${when}</span>
                </div>
                <a href="${it.link}" target="_blank" rel="noopener" class="block">
                  <h3 class="text-[17px] sm:text-xl font-extrabold leading-snug">${it.title}</h3>
                </a>
              </div>
              <a href="${it.link}" target="_blank" rel="noopener" class="shrink-0 w-[44%] sm:w-[300px] aspect-[16/10] rounded-xl overflow-hidden border border-[var(--border)]">
                ${it.image?`<img src="${upscale(it.image)}" class="w-full h-full object-cover" alt="">`:''}
              </a>
            </article>
          </li>`;
      }
    });
    newsList.innerHTML=html;
  };

  const loadFeeds=async ed=>{
    const all=[];
    await Promise.allSettled(feedsFor(ed).map(async f=>{
      try{ const xml=await fetchWithProxies(f); all.push(...parseRSS(xml)); }catch{}
    }));
    const byKey=new Map();
    all.forEach(it=>{ const k=it.title.toLowerCase().replace(/[\W_]+/g,' ').trim(); if(!byKey.has(k)||it.pubDate>byKey.get(k).pubDate) byKey.set(k,it); });
    return Array.from(byKey.values()).slice(0,64);
  };

  (async ()=>{
    const items=await loadFeeds(currentEdition);
    cacheItems=items; filteredItems=items; render(filteredItems);
    // hide preloader
    document.getElementById('preload').style.display='none'; document.body.classList.remove('preloading');
  })();

  // search
  const searchToggle=$('#searchToggle'), searchSheet=$('#searchSheet'), searchField=$('#searchField');
  let open=false; const show=()=>{searchSheet.classList.remove('hidden'); open=true; setTimeout(()=>searchField.focus(),0)}
  const hide=()=>{searchSheet.classList.add('hidden'); open=false}
  searchToggle.addEventListener('click',()=>open?hide():show());
  window.addEventListener('keydown',e=>{ if(e.key==='/'&&!open){e.preventDefault();show()} if(e.key==='Escape'&&open){hide()} });
  searchField.addEventListener('input',e=>{
    const q=(e.target.value||'').toLowerCase().trim();
    filteredItems = cacheItems.filter(it=> it.title.toLowerCase().includes(q) || (it.source||'').toLowerCase().includes(q) || hostname(it.link).includes(q));
    render(filteredItems);
  });

  // theme
  const THEME_KEY='oc_theme', resolveAuto=()=>window.matchMedia('(prefers-color-scheme: light)').matches?'light':'dark';
  function setTheme(mode){ document.documentElement.dataset.theme=mode; const f=mode==='auto'?resolveAuto():mode; document.documentElement.classList.toggle('light',f==='light'); document.documentElement.classList.toggle('dark',f==='dark'); localStorage.setItem(THEME_KEY,mode); document.getElementById('sun').classList.toggle('hidden',f!=='light'); document.getElementById('moon').classList.toggle('hidden',f!=='dark'); }
  setTheme(localStorage.getItem(THEME_KEY)||'auto'); document.getElementById('themeBtn').onclick=()=>{ const cur=localStorage.getItem(THEME_KEY)||'auto'; setTheme(cur==='auto'?'dark':(cur==='dark'?'light':'auto')); };
</script>
</body>
</html>
