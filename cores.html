<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <!-- Pretty URL (client-side mask) -->
  <script>
    window.OC = { base:"", slug:"Cores", file:"/cores.html" };
    (function(L,C){try{
      var B=C.base||"", S="/"+(C.slug||"home"), F=C.file||"/index.html";
      var p=L.pathname.replace(/\/+$/,"");
      if(B && p.startsWith(B)) p=p.slice(B.length)||"/";
      if(p===F || p==="/") history.replaceState(null,"",B+S+L.search+L.hash);
    }catch(_){}})(location, window.OC);
  </script>
  <link rel="canonical" href="/home">

  <title>OpenCounsel — Cores</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#0B1B2B">
  <link rel="icon" type="image/png" href="favicon.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter','ui-sans-serif','system-ui'] },
          colors: { oc: { ink:'#0A0D10', soft:'#F5F7F9', line:'#E7EDF2', accent:'#5B8CFF', lilac:'#E7E7FF' } },
          boxShadow: { card:'0 6px 30px rgba(16,24,40,0.08)', glow:'0 0 0 1px rgba(255,255,255,.06), 0 10px 30px rgba(16,24,40,.18)' }
        }
      }
    }
  </script>

  <style>
    :root{
      --pad-mobile-x:24px; --pad-desktop-x:32px; --line:#E7EDF2;
      --from:#0B1B2Bcc; --via:#0E6F5Ccc; --to:#00CFFFcc; --speed:16s; --angle:135deg;
      --grad-from:#0B1B2Bcc; --grad-via:#0E6F5Ccc; --grad-to:#00CFFFcc;
      --logo-width:64px; --logo-height:64px;
      --hamburger-color:#afafaf;
      --hamburger-inset:13px;
      --hero-shine-duration: 5.5s; --hero-shine-softness: 3.5%;
    }
    html, body { max-width:100%; overflow-x:clip!important; }
    @supports not (overflow-x: clip) { html, body { overflow-x: hidden !important; } }
    .oc-container { padding-left:var(--pad-mobile-x); padding-right:var(--pad-mobile-x); }
    @keyframes gradientShift { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
    .grad-anim{ background:linear-gradient(var(--angle),var(--from),var(--via),var(--to)); background-size:300% 300%; animation:gradientShift var(--speed) ease-in-out infinite; }
    .g-grad{ background:linear-gradient(var(--angle),var(--from),var(--via),var(--to)); background-size:300% 300%; animation:gradientShift 16s ease-in-out infinite; }
    .logo-anim{ display:inline-block; width:var(--logo-width); height:var(--logo-height); background:linear-gradient(135deg,var(--grad-from),var(--grad-via),var(--grad-to)); background-size:300% 300%; animation: gradientShift 16s ease-in-out infinite; -webkit-mask:url('logo.svg') no-repeat center/contain; mask:url('logo.svg') no-repeat center/contain; }
    .nav-link { font-variation-settings:"wght" 520; transition: font-variation-settings 260ms ease, letter-spacing 260ms ease, transform 260ms ease; }
    .nav-link:hover { font-variation-settings:"wght" 700; letter-spacing:.01em; transform:translateY(-.5px) scale(1.02); }

    /* Reveal + scroll polish */
    .reveal { opacity:0; transform: translateY(18px) scale(.98); transition: opacity .6s ease, transform .6s ease; }
    .reveal.in { opacity:1; transform: translateY(0) scale(1); }
    .scroll-fade > * { filter: blur(10px); opacity: .65; transform: translateY(8px); transition: filter .8s cubic-bezier(.16,1,.3,1), opacity .8s cubic-bezier(.16,1,.3,1), transform .8s cubic-bezier(.16,1,.3,1); }
    .scroll-fade.in-view > * { filter: blur(0); opacity: 1; transform: translateY(0); }
    @media (prefers-reduced-motion: reduce){ .reveal, .scroll-fade > * { transition: none !important; filter:none !important; opacity:1 !important; transform:none !important; } }

    /* Apple-like hero text shimmer */
    .hero-shine{
      position:relative;
      /* Two layers: moving highlight + steady base fill */
      background-image:
        linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,.98), rgba(255,255,255,0)),
        linear-gradient(#ffffff, #ffffff);
      background-size: 240% 100%, 100% 100%;
      background-position: -150% 0, 0 0;
      background-repeat:no-repeat;
      -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent; color:transparent;
      animation: heroShine var(--hero-shine-duration) linear infinite;
      animation-fill-mode: both;
    }
    @keyframes heroShine{
      0%{   background-position: -150% 0, 0 0 }
      100%{ background-position:  150% 0, 0 0 }
    }
    @media (prefers-reduced-motion: reduce){ .hero-shine{ animation:none; -webkit-text-fill-color:#fff; color:#fff; background:none; } }

    /* Hero animated orbs (Apple-like, subtle) */
    .hero-orbs{ position:absolute; inset:0; pointer-events:none; z-index:0; overflow:hidden; }
    .hero-orbs .orb{ position:absolute; border-radius:9999px; filter: blur(18px); opacity:.45; mix-blend-mode:screen; }
    .hero-orbs .orb-a{ width:220px; height:220px; left:10%; top:10%; background: radial-gradient(circle at 40% 40%, rgba(0,207,255,.7), rgba(0,207,255,0)); animation: driftA 16s ease-in-out infinite; }
    .hero-orbs .orb-b{ width:180px; height:180px; right:12%; top:24%; background: radial-gradient(circle at 50% 50%, rgba(14,111,92,.6), rgba(14,111,92,0)); animation: driftB 18s ease-in-out infinite; }
    .hero-orbs .orb-c{ width:140px; height:140px; left:18%; bottom:12%; background: radial-gradient(circle at 50% 50%, rgba(255,255,255,.7), rgba(255,255,255,0)); animation: driftC 14s ease-in-out infinite; }
    .hero-orbs .orb-d{ width:260px; height:260px; left:50%; top:55%; transform: translateX(-50%); background: radial-gradient(circle at 50% 50%, rgba(160,228,212,.65), rgba(160,228,212,0)); animation: driftD 20s ease-in-out infinite; }
    @keyframes driftA{ 0%,100%{ transform: translate(0,0)} 50%{ transform: translate(16px, -10px)} }
    @keyframes driftB{ 0%,100%{ transform: translate(0,0)} 50%{ transform: translate(-14px, 12px)} }
    @keyframes driftC{ 0%,100%{ transform: translate(0,0)} 50%{ transform: translate(10px, 8px)} }
    @keyframes driftD{ 0%,100%{ transform: translate(-50%,0)} 50%{ transform: translate(-50%, -12px)} }
    @media (prefers-reduced-motion: reduce){ .hero-orbs .orb{ animation:none !important; } }

    /* Chips */
    .chip{ font-size:12px; line-height:1; border:1px solid var(--line); background:#fff; border-radius:999px; padding:6px 10px; box-shadow:inset 0 1px 0 rgba(255,255,255,0.6),0 6px 14px rgba(10,13,16,.06); transition:transform .12s ease, background .2s ease, border-color .2s ease; }
    .chip:hover{ transform:translateY(-1px); }
    .chip-on{ background:#0A0D10; color:#fff; border-color:#0A0D10; }

    /* Tilt + sheen */
    .tilt{ transform-style: preserve-3d; transition: transform .28s cubic-bezier(.22,.8,.22,1), box-shadow .28s ease; will-change: transform; }
    @media (hover:hover){ .tilt:hover{ transform: translateY(-3px) scale(1.01); } }
    .sheen-sweep{ pointer-events:none; background: linear-gradient(120deg, transparent 35%, rgba(255,255,255,.32) 50%, transparent 65%); transform: translateX(-120%) skewX(-12deg); animation: sheen 9s cubic-bezier(.16,1,.3,1) infinite; }
    @keyframes sheen{ 0%{ transform: translateX(-120%) skewX(-12deg) } 12%{ transform: translateX(120%) skewX(-12deg) } 100%{ transform: translateX(120%) skewX(-12deg) } }
    @media (prefers-reduced-motion: reduce){ .sheen-sweep{ display:none; } }

    /* Brand gradient helpers (used in modal banner) */
    .brand-gradient{ background-image:linear-gradient(135deg,#00CFFF,#0E6F5C,#00CFFF); background-size:200% 200%; }
    .breathing{ animation:breathe 6s ease-in-out infinite; }
    @keyframes breathe{0%{background-position:0% 50%;filter:saturate(.95)}50%{background-position:100% 50%;filter:saturate(1.05)}100%{background-position:0% 50%;filter:saturate(.95)}}

    /* Drawer / mobile */
    #mobileMenu { position:fixed; inset:0; z-index:60; display:none; pointer-events:none; }
    #mobileMenu .menu-scrim{
      position:absolute; inset:0; background: rgba(255,255,255,0.92);
      -webkit-backdrop-filter: blur(12px); backdrop-filter: blur(12px);
      opacity:0; transition: opacity 2s ease, backdrop-filter 2s ease, -webkit-backdrop-filter 2s ease;
    }
    #mobileMenu .menu-panel{
      position:absolute; top:0; left:0; height:100%; width:min(88vw, 420px); background:#fff;
      border-right: 1px solid rgba(0,0,0,.06); box-shadow: 0 24px 60px rgba(0,0,0,.12);
      transform: translateX(-100%); opacity:.98; filter: blur(12px);
      transition: transform .5s cubic-bezier(.22,.9,.22,1), filter 1s ease .1s;
      display:flex; flex-direction:column; padding:18px 20px;
    }
    #mobileMenu.active { display:block; pointer-events:auto; }
    #mobileMenu.active .menu-scrim{ opacity:1; -webkit-backdrop-filter:blur(0px); backdrop-filter:blur(0px); }
    #mobileMenu.active .menu-panel{ transform:translateX(0); filter:blur(0); }
    .drawer-title{ font-weight:700; letter-spacing:-.01em; background: linear-gradient(135deg, var(--grad-from), var(--grad-via), var(--grad-to)); background-size:300% 300%; animation:gradientShift 16s ease-in-out infinite; -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent; color:transparent; font-size:20px; }
    .drawer-close{ display:inline-flex; align-items:center; justify-content:center; width:40px; height:40px; border-radius:12px; border:1px solid rgba(0,0,0,.06); background:rgba(255,255,255,.8); }

    /* Simple, smooth hamburger */
    .hamburger { width: 32px; height: 28px; display: inline-flex; flex-direction: column; justify-content: center; gap: 6px; }
    .hamburger span {
      height: 3px; width: 100%; border-radius: 9999px;
      background: var(--hamburger-color, #000);
      animation: none; background-size: initial;
      transition: transform .4s ease, opacity .2s ease, background-color .2s ease;
    }
    #hamburgerBtn.is-active .hamburger span:nth-child(1){ transform: translateY(9px) rotate(45deg); }
    #hamburgerBtn.is-active .hamburger span:nth-child(2){ opacity: 0; }
    #hamburgerBtn.is-active .hamburger span:nth-child(3){ transform: translateY(-9px) rotate(-45deg); }
    .drawer-nav a:not(.drawer-cta){ display:block; padding:14px 2px; font-weight:700; font-size:clamp(18px,4.4vw,20px); line-height:1.2; background: linear-gradient(135deg, var(--grad-from), var(--grad-via), var(--grad-to)); background-size:300% 300%; animation:gradientShift 16s ease-in-out infinite; -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent; color:transparent; }
    .drawer-sep{ height:1px; background:linear-gradient(90deg, transparent, rgba(0,0,0,.08), transparent); margin:8px 0 6px; }
    .drawer-cta{ display:inline-flex!important; align-items:center; justify-content:center; width:100%; text-align:center; position:relative; color:#fff!important; -webkit-text-fill-color:#fff!important; background-clip:border-box!important; -webkit-background-clip:border-box!important; overflow:hidden; }

    /* Modal */
    #coreModal.active .modal-scrim{ opacity:1; }
    #coreModal.active .modal-panel{ opacity:1; transform: translate(-50%, 0); }
    @media (prefers-reduced-motion: reduce){ #coreModal .modal-scrim, #coreModal .modal-panel{ transition:none !important; } }
    .rating i{ color:#f5b50a }
    .card{ border:1px solid var(--line); background:#fff; box-shadow: 0 10px 30px rgba(10,13,16,.06); }
    .card-grad{ background: linear-gradient(135deg, #0B1B2B, #0E6F5C, #00CFFF); color:#fff; border:1px solid rgba(255,255,255,.18); box-shadow: 0 16px 54px rgba(0,0,0,.18); }
    /* Dark card for Pro section */
    .card-dark{ background:#0A0D10; color:#fff; border:1px solid rgba(255,255,255,.12); box-shadow: 0 16px 54px rgba(0,0,0,.28); }
    .card-dark .text-neutral-900{ color:#fff !important }
    .card-dark .text-neutral-700{ color:rgba(255,255,255,.85) !important }
    .card-dark .pill{ background:rgba(255,255,255,.08); border-color:rgba(255,255,255,.18); color:#fff }
    .card-dark .pill-pro{ background:#fff; color:#0A0D10; border-color:#fff }
    .badge{ font-size:11px; padding:4px 8px; border-radius:999px; border:1px solid var(--line); background:#fff; }
    .pill{ font-size:12px; line-height:1; padding:6px 10px; border-radius:999px; border:1px solid var(--line); background:#fff; font-weight:600; display:inline-flex; align-items:center; white-space:nowrap; }
    .pill-pro{ color:#fff; background:#0A0D10; border-color:#0A0D10; box-shadow:0 10px 26px rgba(0,0,0,.18) }
    .pill-soon{ background:#f3f4f6; border-color:#e5e7eb; color:#0A0D10 }
    /* Showcase scenes */
    .showcase{ position:absolute; inset:0; border-radius:22px; overflow:hidden; }
    .scene{ position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:16px; opacity:0; transform: translateY(12px) scale(.985); }
    .scene .cap{ font-size:12px; letter-spacing:.12em; text-transform:uppercase; color:#fff; opacity:.85 }
    .scene .row{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:center; }
    .chip-lg{ display:inline-flex; align-items:center; gap:8px; font-weight:600; padding:10px 14px; border-radius:9999px; background:#fff; color:#0A0D10; border:1px solid rgba(0,0,0,.08); box-shadow:0 10px 26px rgba(10,13,16,.12); transform: translateY(8px); opacity:0 }
    .chip-lg.pro{ background:#0A0D10; color:#fff; border-color:#0A0D10 }
    .chip-lg.soon{ background:#f3f4f6; color:#0A0D10; border-color:#e5e7eb }
    .scene.active{ opacity:1; transform: translateY(0) scale(1); transition: opacity .8s cubic-bezier(.22,.8,.22,1), transform .8s cubic-bezier(.22,.8,.22,1) }
    .scene.active .chip-lg{ animation: chipIn .7s cubic-bezier(.22,.8,.22,1) forwards; }
    .scene.active .chip-lg:nth-child(1){ animation-delay: .06s }
    .scene.active .chip-lg:nth-child(2){ animation-delay: .14s }
    .scene.active .chip-lg:nth-child(3){ animation-delay: .22s }
    @keyframes chipIn{ from{ transform: translateY(8px); opacity:0 } to{ transform: translateY(0); opacity:1 } }
    @media (prefers-reduced-motion: reduce){ .scene, .chip-lg{ transition:none !important; animation:none !important; opacity:1 !important; transform:none !important } }

    /* Modal banner ring */
    .banner-ring{ position:absolute; inset:0; display:grid; place-items:center; }
    .banner-ring .ring{ position:absolute; inset:12% 12%; border-radius:9999px; display:grid; place-items:center; }
    .banner-ring .spin{ animation: spin 18s linear infinite; }
    .banner-ring .counter{ animation: counterSpin 18s linear infinite; }
    .banner-token{ position:absolute; width:42px; height:42px; display:grid; place-items:center; border-radius:12px; box-shadow:0 8px 22px rgba(0,0,0,.12); background:#fff; border:1px solid rgba(0,0,0,.06); color:#0A0D10; }
    .banner-token.dark{ background:#0A0D10; color:#fff; border-color:#0A0D10; }
    .banner-token{ --n:5; --r: 44%; left:50%; top:50%; transform: translate(-50%,-50%) rotate(calc(360deg/var(--n)*var(--i))) translate(var(--r)) rotate(calc(-360deg/var(--n)*var(--i))); }

    /* Modal demo styles */
    .demo{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; padding:18px; }
    .demo-card{ width:100%; height:100%; border-radius:16px; background:#fff; border:1px solid rgba(0,0,0,.06); box-shadow: 0 12px 30px rgba(10,13,16,.08); padding:16px; overflow:hidden; }
    .demo-row{ display:flex; align-items:center; gap:8px; margin-bottom:8px; }
    .demo-bar{ height:10px; border-radius:8px; background:#eaecef; animation: barIn .6s cubic-bezier(.22,.8,.22,1) both; }
    .demo-bar.sm{ height:8px }
    .demo-bar.l1{ width:68% }
    .demo-bar.l2{ width:52% }
    .demo-bar.l3{ width:80% }
    .demo-bar.l4{ width:36% }
    .demo-bar.hl{ background:linear-gradient(135deg,#00CFFF,#0E6F5C,#00CFFF); background-size:200% 200%; animation: barIn .5s ease both, gradientShift 8s ease-in-out infinite; filter: saturate(1.15); }
    @keyframes barIn{ from{ opacity:0; transform: translateY(6px) } to{ opacity:1; transform: translateY(0) } }
    .bubble{ max-width:74%; border-radius:14px; padding:10px 12px; font-size:13px; line-height:1.45; box-shadow: 0 6px 20px rgba(0,0,0,.06); background:#f3f4f6; color:#0A0D10; animation: pop .5s cubic-bezier(.22,.8,.22,1) both }
    .bubble.me{ margin-left:auto; background:#0A0D10; color:#fff }
    .bubble:nth-child(1){ animation-delay:.05s }
    .bubble:nth-child(2){ animation-delay:.16s }
    .bubble:nth-child(3){ animation-delay:.27s }
    @keyframes pop{ from{ opacity:0; transform: translateY(8px) scale(.98) } to{ opacity:1; transform: translateY(0) scale(1) } }
    .quote{ background:#fff; border:1px solid rgba(0,0,0,.06); border-left:3px solid #0A0D10; border-radius:10px; padding:10px 12px; font-size:12px; line-height:1.5; box-shadow: 0 6px 18px rgba(0,0,0,.06); animation: pop .5s cubic-bezier(.22,.8,.22,1) both }
    .quote + .quote{ margin-top:8px }
    .soon-badge{ position:absolute; top:10px; right:10px; font-size:11px; padding:6px 10px; border-radius:9999px; background:#f3f4f6; border:1px solid #e5e7eb; color:#0A0D10 }
    @media (prefers-reduced-motion: reduce){ .demo *, .bubble, .quote, .demo-bar{ animation:none !important } }

    /* Demo toolstrip */
    .toolstrip{ display:flex; align-items:center; gap:8px; margin-bottom:12px; }
    .tool{ width:28px; height:28px; display:grid; place-items:center; border-radius:9999px; background:#f3f4f6; color:#0A0D10; border:1px solid rgba(0,0,0,.06); box-shadow: 0 6px 16px rgba(10,13,16,.06); }
    .tool.dark{ background:#0A0D10; color:#fff; border-color:#0A0D10 }
    .tool.active{ background:linear-gradient(135deg,#0B1B2B,#0E6F5C,#00CFFF); color:#fff; border:0; box-shadow: 0 10px 24px rgba(0,0,0,.18); animation: toolPulse 2.8s ease-in-out infinite; }
    .toolstrip .tool:nth-child(1){ animation-delay:.0s }
    .toolstrip .tool:nth-child(2){ animation-delay:.6s }
    .toolstrip .tool:nth-child(3){ animation-delay:1.2s }
    .toolstrip .tool:nth-child(4){ animation-delay:1.8s }
    @keyframes toolPulse{ 0%, 100%{ transform: translateY(0); filter:saturate(1); opacity:1 } 50%{ transform: translateY(-2px); filter:saturate(1.15); opacity:.95 } }

    /* New Apple‑like hero stage */
    .ad-stage{ position:absolute; inset:0; isolation:isolate; overflow:hidden; pointer-events:auto; z-index:0; contain: paint; transform: translateZ(0); will-change: transform; }
    @media (max-width:767px){
      .ad-stage{ pointer-events:none }
      /* Mobile layout: move animation below content */
      /* Use !important to override Tailwind utilities loaded later */
      .hero-card{ flex-direction: column !important; align-items: stretch !important; text-align: left !important; }
      .hero-card .hero-content{ order: 1; width:100%; }
      .hero-card .ad-stage{ position: relative; inset: auto; order: 2; width:100%; height: clamp(300px, 60vw, 420px); margin-top: 16px; border-radius: 16px; }
      /* Lighter animation cost on mobile while preserving look */
      :root{ --speed: 22s; }
      .ad-halo{ filter: blur(20px); opacity:.55 }
      .ad-card{ -webkit-backdrop-filter: none !important; backdrop-filter: none !important; background: rgba(255,255,255,.92); box-shadow:0 10px 26px rgba(10,13,16,.18); transform: translateZ(0); }
      .ad-card.pro{ background: rgba(10,13,16,.94); }
      /* Step heavy gradients instead of 60fps to cut paints */
      .hero-card.grad-anim, .hero-card.g-grad{ animation-duration: 40s !important; animation-timing-function: steps(20, end) !important; }
      /* Make hero text shimmer update in steps as well */
      .hero-shine{ animation-duration: 12s !important; animation-timing-function: steps(24, end) !important; }
    }
    .ad-halo{ position:absolute; inset:-10% -20%; filter: blur(28px); opacity:.6; pointer-events:none; background:
      radial-gradient(60% 60% at 60% 40%, rgba(0,207,255,.55), rgba(0,0,0,0) 70%),
      radial-gradient(50% 50% at 40% 60%, rgba(14,111,92,.45), rgba(0,0,0,0) 70%);
    }
    .ad-card{ position:absolute; left:0; top:0; transform: none; pointer-events:auto;
      width: clamp(168px, 36%, 240px); padding:14px; border-radius:18px; border:1px solid rgba(255,255,255,.4);
      background:rgba(255,255,255,.9); backdrop-filter: blur(8px); box-shadow:0 18px 50px rgba(10,13,16,.25);
      display:flex; align-items:center; gap:12px; cursor:pointer; transition: box-shadow .4s ease; will-change: transform; transform-origin:center;
    }
    .ad-card:hover{ box-shadow:0 24px 60px rgba(10,13,16,.3) }
    .ad-card.pro{ background: rgba(10,13,16,.92); color:#fff; border-color: rgba(255,255,255,.25) }
    .ad-icon{ display:grid; place-items:center; width:44px; height:44px; border-radius:14px; }
    .ad-icon.std{ background:#0A0D10; color:#fff }
    .ad-icon.pro{ background:#fff; color:#0A0D10 }
    .ad-meta{ display:flex; flex-direction:column; gap:4px }
    .ad-name{ font-weight:700 }
    .ad-pill{ font-size:11px; line-height:1; padding:5px 8px; border-radius:9999px; background:#fff; color:#0A0D10; border:1px solid rgba(0,0,0,.08); width:fit-content }
    .ad-pill-pro{ background:#0A0D10; color:#fff; border-color:#0A0D10 }
    .ad-pill-soon{ background:#f3f4f6; color:#0A0D10; border-color:#e5e7eb }
    @media (prefers-reduced-motion: reduce){ .ad-card{ animation:none !important } }

    /* Bouncing within container (alternate direction) */
    .ad-float{ position:absolute; left:var(--start-x,10%); top:var(--start-y,10%); will-change: transform; }
    .fx{ animation: fxMove var(--dur-x,16s) cubic-bezier(.22,.8,.22,1) infinite alternate }
    .fy{ animation: fyMove var(--dur-y,18s) cubic-bezier(.22,.8,.22,1) infinite alternate }
    @keyframes fxMove{ from{ transform: translateX(0) } to{ transform: translateX(var(--dx,60%)) } }
    @keyframes fyMove{ from{ transform: translateY(0) } to{ transform: translateY(var(--dy,40%)) } }
    @media (max-width: 640px){ .orbit-a{ --r: 110px } .orbit-b{ --r: 135px } .orbit-c{ --r: 160px } }

    /* When JS physics is active, disable CSS motion on wrappers and expand bounds */
    .ad-stage.js-physics .fx, .ad-stage.js-physics .fy{ animation:none !important; transform:none !important; width:100%; height:100%; }
    .ad-stage.js-physics .ad-float{ left:0 !important; top:0 !important; width:100%; height:100%; }

    /* Spin sequence */
    .ad-card.spin{ animation: spin360 4.6s cubic-bezier(.22,.8,.22,1) }
    @keyframes spin360{ from{ transform: rotate(0deg) } to{ transform: rotate(360deg) } }

    /* Marketplace FX */
    #marketFxWrap{ position:relative; }
    #marketFx{ position:absolute; inset:-10% -5% 0 -5%; z-index:-1; filter: blur(0.3px) saturate(1.1); opacity:.7; }
    .market-orb{ position:absolute; width:220px; height:220px; border-radius:50%; filter: blur(40px); opacity:.35; }
    .market-orb.c1{ background: radial-gradient(closest-side, rgba(0,207,255,.20), transparent 70%); left: -60px; top: -40px; }
    .market-orb.c2{ background: radial-gradient(closest-side, rgba(14,111,92,.20), transparent 70%); right: -40px; top: 120px; }
    .market-orb.c3{ background: radial-gradient(closest-side, rgba(160,228,212,.18), transparent 70%); left: 20%; bottom: -30px; width:260px; height:260px; }
    @media (prefers-reduced-motion: reduce){ #marketFx{ display:none !important } }
  </style>
</head>

<body class="bg-white text-oc-ink font-sans antialiased">
  <div id="pageBlur" class="page-blur" aria-hidden="true"></div>

  <!-- HEADER -->
  <header class="sticky top-0 z-50 bg-white">
    <div class="relative mx-auto max-w-[1200px] oc-container h-14 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <a href="index.html" aria-label="OpenCounsel home"><span class="logo-anim" role="img" aria-label="OpenCounsel"></span></a>
      </div>
      <nav class="hidden md:flex absolute left-1/2 -translate-x-1/2 items-center gap-8 text-sm">
        <a class="nav-link font-semibold text-black" href="pro.html">PRO</a>
        <a class="nav-link grad-anim bg-clip-text text-transparent font-medium" href="cores.html">Cores</a>
      </nav>
      <div class="flex items-center gap-2">
        <a
          href="download.html"
          class="hidden md:inline-flex items-center gap-2 rounded-2xl px-4 py-2 text-sm font-semibold text-white
                 focus:outline-none focus-visible:ring-4 focus-visible:ring-white/60
                 shadow-xl shadow-black/20 hover:shadow-2xl hover:shadow-black/30
                 transition-all duration-300 ease-out hover:-translate-y-[1px] active:translate-y-0
                 g-grad grad-anim"
          style="--from:var(--grad-from); --via:var(--grad-via); --to:var(--grad-to); --speed:16s; --angle:135deg;"
          aria-label="Download" title="Download"
        >
          <i class="ph ph-download text-base" aria-hidden="true"></i>
          <span>Download</span>
        </a>
        <button id="hamburgerBtn" class="md:hidden rounded-xl bg-transparent focus:outline-none focus:ring-2 focus:ring-oc-accent" aria-label="Open menu" aria-expanded="false" aria-controls="mobileMenu">
          <span class="hamburger" aria-hidden="true"><span></span><span></span><span></span></span>
        </button>
      </div>
    </div>

    <!-- MOBILE MENU -->
    <div id="mobileMenu" aria-hidden="true">
      <div class="menu-scrim"></div>
      <aside class="menu-panel">
        <div class="drawer-head flex items-center justify-between pb-1">
          <a href="index.html" class="drawer-title">OC</a>
          <button id="closeMenuBtn" class="drawer-close" aria-label="Close menu">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6 6l12 12M18 6L6 18" stroke="#0A0D10" stroke-width="2" stroke-linecap="round"/></svg>
          </button>
        </div>
        <nav class="drawer-nav mt-2">
          <a href="pro.html" style="background:none;-webkit-text-fill-color:#0A0D10;color:#0A0D10;font-weight:700">PRO</a>
          <a href="cores.html">Cores</a>
          <div class="drawer-sep"></div>
          <a href="download.html" class="drawer-cta grad-anim rounded-2xl px-6 py-3 font-semibold text-white inline-flex items-center justify-center" style="--from:var(--grad-from); --via:var(--grad-via); --to:var(--grad-to); --speed:16s; --angle:135deg;">
            <i class="ph ph-download text-xl mr-2"></i><span>Get OpenCounsel</span>
          </a>
        </nav>
      </aside>
    </div>
  </header>

  <!-- HERO -->
  <section id="home" class="mx-auto max-w-[1200px] oc-container">
    <div class="hero-card relative g-grad grad-anim rounded-2xl overflow-hidden border border-oc-line flex items-center text-center px-[var(--pad-mobile-x)] lg:px-[var(--pad-desktop-x)] py-16">
      <!-- Soft background glows -->
      <div aria-hidden="true" class="pointer-events-none absolute inset-0 -z-10">
        <div class="absolute left-1/2 top-[-6rem] h-[22rem] w-[42rem] -translate-x-1/2 rounded-full blur-3xl" style="background: radial-gradient(60% 60% at 50% 40%, rgba(160,228,212,.22), rgba(160,228,212,0) 70%);"></div>
        <div class="absolute right-[-8%] bottom-[-12%] h-[18rem] w-[18rem] rounded-full blur-3xl" style="background: radial-gradient(55% 55% at 50% 50%, rgba(0,207,255,.14), rgba(0,207,255,0) 70%);"></div>
      </div>

      

      <div class="hero-content w-full max-w-[1100px] mx-auto grid grid-cols-1 md:grid-cols-2 items-center gap-10 relative z-[1]">
        <!-- Copy -->
        <div class="text-left flex flex-col items-start">
          <h1 class="font-semibold text-white text-4xl md:text-6xl leading-tight">
            <span class="hero-shine">Meet the Cores</span>
          </h1>
          <p class="mt-3 md:mt-4 text-white/90 text-lg md:text-xl max-w-xl">A Core is a complete environment — purpose‑built for the job.</p>
          <p class="mt-1 text-white/80 text-base md:text-lg max-w-xl">Swap a Core and your model, knowledge, workspace, UI, and tools adapt instantly — enabling medicine, engineering, coaching, and more. One at a time.</p>

          <div class="mt-6 flex items-center gap-3">
            <a href="#marketplace" class="relative inline-flex items-center gap-2 rounded-2xl px-5 py-3 text-sm font-semibold text-white g-grad grad-anim hover:-translate-y-[1px] transition will-change-transform">
              <span class="pointer-events-none absolute inset-0 -z-10 rounded-2xl blur-xl opacity-70" style="background: radial-gradient(60% 60% at 50% 50%, rgba(0,207,255,.35), rgba(0,0,0,0));"></span>
              <i class="ph ph-grid-four text-base"></i>
              <span>Explore Cores</span>
            </a>
            <button class="inline-flex items-center gap-2 rounded-2xl border border-white/40 bg-white/10 text-white px-5 py-3 text-sm font-semibold hover:bg-white/20" data-open-core="ocpro">
              <i class="ph ph-seal-check"></i>
              <span>Learn about OC‑Pro</span>
            </button>
          </div>
        </div>

        
      </div>

      <!-- Full-hero floating stage (below copy on mobile, behind on desktop) -->
      <div class="ad-stage" aria-hidden="true">
        <div class="ad-halo"></div>
        <!-- Bouncing nodes (smooth, upright) -->
        <div class="ad-float fx" style="--start-x:8%; --dx:84%; --dur-x:22s">
          <div class="fy" style="--start-y:6%; --dy:82%; --dur-y:24s">
            <div class="ad-card std" data-open-core="oc">
              <div class="ad-icon std"><i class="ph ph-cpu"></i></div>
              <div class="ad-meta"><div class="ad-name">OC‑Core</div><div class="ad-pill">Standard</div></div>
            </div>
          </div>
        </div>
        <div class="ad-float fx" style="--start-x:52%; --dx:46%; --dur-x:26s">
          <div class="fy" style="--start-y:12%; --dy:78%; --dur-y:28s">
            <div class="ad-card pro" data-open-core="ocpro">
              <div class="ad-icon pro"><i class="ph ph-seal-check"></i></div>
              <div class="ad-meta"><div class="ad-name">OC‑Pro</div><div class="ad-pill ad-pill-pro">Pro</div></div>
            </div>
          </div>
        </div>
        <div class="ad-float fx" style="--start-x:18%; --dx:70%; --dur-x:24s">
          <div class="fy" style="--start-y:48%; --dy:46%; --dur-y:22s">
            <div class="ad-card soon" data-open-core="oclaw">
              <div class="ad-icon pro"><i class="ph ph-scales"></i></div>
              <div class="ad-meta"><div class="ad-name">OC‑Law</div><div class="ad-pill ad-pill-soon">Coming soon</div></div>
            </div>
          </div>
        </div>
      </div>
      </div>
  </section>

  <!-- POST-HERO DEMO CHAT (animation slot below hero) -->
  <section id="core-demo" class="mx-auto max-w-[1200px] oc-container mt-6 md:mt-10">
    <div id="coreDemoSlot" class="relative mx-auto w-full max-w-[620px]">
      <!-- Segmented control -->
      <div id="coreSwitcher" role="radiogroup" aria-label="Select a Core" class="mx-auto w-fit rounded-full border border-oc-line bg-white/80 backdrop-blur-sm px-1 py-1 flex gap-1 dark:bg-neutral-900/70" tabindex="0">
        <button type="button" role="radio" aria-checked="true" data-core="oc" aria-controls="coreDemoPanel" class="seg-pill inline-flex items-center gap-2 px-3.5 py-2 rounded-full text-sm font-semibold text-neutral-800 dark:text-neutral-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-black/60 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-white/70 dark:focus-visible:ring-offset-neutral-900">
          <i class="ph ph-cpu text-base"></i>
          <span>OC‑Core</span>
        </button>
        <button type="button" role="radio" aria-checked="false" data-core="research" aria-controls="coreDemoPanel" class="seg-pill inline-flex items-center gap-2 px-3.5 py-2 rounded-full text-sm font-medium text-neutral-700 dark:text-neutral-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-black/60 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-white/70 dark:focus-visible:ring-offset-neutral-900">
          <i class="ph ph-flask text-base"></i>
          <span>OC‑Research‑Core</span>
        </button>
        <button type="button" role="radio" aria-checked="false" data-core="coach" aria-controls="coreDemoPanel" class="seg-pill inline-flex items-center gap-2 px-3.5 py-2 rounded-full text-sm font-medium text-neutral-700 dark:text-neutral-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-black/60 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-white/70 dark:focus-visible:ring-offset-neutral-900">
          <i class="ph ph-compass-tool text-base"></i>
          <span>OC‑Coach‑Core</span>
        </button>
      </div>

      <!-- Chat Card -->
      <div id="coreDemoPanel" role="region" aria-labelledby="coreTitle" aria-live="polite" aria-atomic="true" class="mt-4 rounded-2xl border border-oc-line bg-white/75 dark:bg-neutral-900/70 backdrop-blur-md shadow-[0_20px_60px_rgba(0,0,0,.12)]">
        <div id="coreDemoHeader" class="flex items-center justify-between px-4 py-3">
          <div class="flex items-center gap-2">
            <div id="coreIcon" class="h-7 w-7 rounded-xl bg-neutral-900 text-white dark:bg-white dark:text-neutral-900 flex items-center justify-center">
              <i class="ph ph-cpu"></i>
            </div>
            <div>
              <div id="coreTitle" class="text-sm font-semibold text-neutral-900 dark:text-white">OC‑Core</div>
              <div id="coreSub" class="text-[11px] text-neutral-600 dark:text-neutral-300">General</div>
            </div>
          </div>
          <div id="coreHeaderChip" class="hidden text-[11px] px-2 py-1 rounded-full border font-medium"></div>
        </div>
        <div class="px-4 pb-4">
          <div id="chatWrap" class="relative">
            <!-- Bubbles injected by script -->
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- MARKETPLACE -->
  <section id="marketplace" class="section-clip mx-auto max-w-[1200px] oc-container my-10 md:my-12">
    <div id="marketFxWrap" aria-hidden="true">
      <canvas id="marketFx"></canvas>
      <div class="market-orb c1"></div>
      <div class="market-orb c2"></div>
      <div class="market-orb c3"></div>
    </div>
    <!-- Refined header -->
    <div class="flex items-start justify-between gap-4">
      <div>
        <div class="inline-flex items-center gap-2 rounded-full border border-neutral-200 bg-white px-3 py-1 text-[11px] font-semibold tracking-wide text-neutral-700 uppercase">OC Cores</div>
        <h2 class="mt-3 text-2xl md:text-3xl font-semibold text-neutral-900">One&nbsp;Core&nbsp;One&nbsp;Focus</h2>
        <p class="text-neutral-600 mt-1 text-sm md:text-base">Activate a single Core to get a purpose-built environment: medicine, engineering, coaching, and more. Everything updates as a set. One at a time.</p>
        <p class="text-neutral-600 mt-2 text-sm md:text-base">OC Databases are proprietary and curated — verified, legally sound knowledge that reduces hallucinations and keeps answers accurate.</p>
      </div>
      <div id="resultsMeta" class="hidden md:flex items-center gap-3 text-sm text-neutral-600"></div>
    </div>

    <!-- Grouped by tier: Standard first, then Pro -->
    <div id="stdWrap" class="mt-8">
      <div class="flex items-center justify-between">
        <h3 class="text-lg md:text-xl font-semibold text-neutral-900">Standard</h3>
        <div id="stdCount" class="text-sm text-neutral-600"></div>
      </div>
      <div id="stdGrid" class="mt-3 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6"></div>
    </div>

    <div id="proWrap" class="mt-12">
      <div class="flex items-center justify-between">
        <h3 class="text-lg md:text-xl font-semibold text-neutral-900">Pro</h3>
        <div id="proCount" class="text-sm text-neutral-600"></div>
      </div>
      <div id="proGrid" class="mt-3 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6"></div>
    </div>

    <div id="emptyState" class="hidden mt-10 rounded-3xl border border-neutral-200 bg-white p-8 text-center">
      <div class="mx-auto w-fit rounded-full border border-black/10 bg-white/70 px-3 py-1 text-[11px] font-medium uppercase tracking-wide text-neutral-700">No results</div>
      <p class="mt-3 text-neutral-700">Try different keywords or filters.</p>
      <div class="mt-5">
        <button id="resetFiltersBtn" class="inline-flex items-center gap-2 rounded-2xl border border-neutral-300 bg-white px-4 py-2 text-sm font-medium text-neutral-900 hover:bg-neutral-50"><i class="ph ph-arrow-counter-clockwise"></i> Reset filters</button>
      </div>
    </div>

    <!-- Featured banner -->
    <div class="mt-10 md:mt-14 scroll-fade card-glass g-grad grad-anim rounded-3xl overflow-hidden border border-oc-line">
      <div class="p-6 md:p-10 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <h3 class="text-xl md:text-2xl font-semibold text-white">Featured: OC‑Pro</h3>
          <p class="mt-1 text-white/85 max-w-xl">Crystal‑clear structure and language for briefs, memos, and decks.</p>
        </div>
        <div class="flex items-center gap-3">
          <button class="inline-flex items-center gap-2 rounded-2xl bg-white text-oc-ink px-4 py-2 text-sm font-semibold hover:bg-gray-100" data-open-core="ocpro"><i class="ph ph-seal-check"></i> Learn about OC‑Pro</button>
          <a href="download.html" class="inline-flex items-center gap-2 rounded-2xl border border-white/30 bg-white/10 text-white px-4 py-2 text-sm font-semibold hover:bg-white/20"><i class="ph ph-download-simple"></i> Get OC</a>
        </div>
      </div>
    </div>
  </section>

  <!-- MY CORES -->
  

  <!-- DETAILS MODAL -->
  <div id="coreModal" class="fixed inset-0 z-[60] hidden" aria-hidden="true">
    <div class="modal-scrim absolute inset-0 bg-black/40 backdrop-blur-sm opacity-0 transition-opacity duration-300"></div>
    <div class="modal-panel absolute left-1/2 top-12 -translate-x-1/2 w-[min(92vw,860px)] rounded-3xl border border-neutral-200 bg-white shadow-[0_40px_80px_rgba(10,13,16,.25)] opacity-0 translate-y-3 transition duration-300 will-change-transform" role="dialog" aria-modal="true" aria-labelledby="mTitle">
      <div class="p-6 md:p-7">
        <div class="flex items-start justify-between gap-4">
          <div class="flex items-center gap-3">
            <div id="mIcon" class="h-11 w-11 rounded-2xl bg-neutral-900/90 text-white flex items-center justify-center"></div>
            <div>
              <h3 id="mTitle" class="text-xl font-semibold tracking-tight text-neutral-900">Core</h3>
              <div class="mt-1 text-xs text-neutral-600 flex items-center gap-2"><span id="mTags"></span></div>
            </div>
          </div>
          <button id="closeModalBtn" class="rounded-xl border border-neutral-200 bg-white px-3 py-2 text-sm font-medium text-neutral-900 hover:bg-neutral-50" aria-label="Close"><i class="ph ph-x"></i></button>
        </div>

        <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
          <div class="md:col-span-2">
            <div id="mBanner" class="relative h-60 md:h-64 rounded-2xl overflow-hidden border border-neutral-200 bg-neutral-50"></div>
            <p id="mDesc" class="mt-4 text-[15px] leading-relaxed text-neutral-800"></p>
          </div>
          <div class="md:col-span-1">
            <div class="rounded-2xl border border-neutral-200 bg-white p-4">
              <ul class="space-y-2 text-sm text-neutral-800" id="mBullets"></ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="border-t border-oc-line">
    <div class="mx-auto max-w-[1200px] oc-container py-10 flex items-center flex-col gap-6 text-oc-ink/60 text-sm">
      <div class="text-center"><span class="font-semibold text-black">OpenCounsel</span> © <span id="yr"></span> OpenCounsel</div>
      <div class="flex items-center gap-4">
        <a class="hover:text-oc-ink" href="contact.html">Contact</a>
        <a class="hover:text-oc-ink" href="#">Privacy</a>
        <a class="hover:text-oc-ink" href="#">Terms</a>
        <a class="hover:text-oc-ink" href="download.html">Download</a>
      </div>
    </div>
  </footer>

  <script>
    // Year + page blur
    const yr = document.getElementById('yr'); if (yr) yr.textContent = new Date().getFullYear();
    window.addEventListener('load', () => {
      const pageBlur = document.getElementById('pageBlur');
      if (!pageBlur) return;
      pageBlur.classList.add('hide');
      setTimeout(() => pageBlur.remove(), 1300);
    });

    // ====== Mobile menu ======
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const mobileMenu   = document.getElementById('mobileMenu');
    const closeMenuBtn = document.getElementById('closeMenuBtn');
    function openMenu() { if (window.matchMedia('(min-width: 768px)').matches) return; mobileMenu.style.display = 'block'; void mobileMenu.offsetWidth; mobileMenu.classList.add('active'); hamburgerBtn.classList.add('is-active'); hamburgerBtn.setAttribute('aria-expanded', 'true'); mobileMenu.setAttribute('aria-hidden','false'); document.body.classList.add('overflow-hidden'); }
    function closeMenu() { mobileMenu.classList.remove('active'); hamburgerBtn.classList.remove('is-active'); hamburgerBtn.setAttribute('aria-expanded', 'false'); mobileMenu.setAttribute('aria-hidden','true'); document.body.classList.remove('overflow-hidden'); setTimeout(()=>{ if(!mobileMenu.classList.contains('active')) mobileMenu.style.display = 'none'; }, 550); }
    hamburgerBtn?.addEventListener('click', ()=> mobileMenu.classList.contains('active') ? closeMenu() : openMenu());
    closeMenuBtn?.addEventListener('click', closeMenu);
    mobileMenu?.addEventListener('click', (e)=>{ if (e.target.classList.contains('menu-scrim')) closeMenu(); });
    const mq = window.matchMedia('(min-width: 768px)');
    function handleMQ(e){ if (e.matches) closeMenu(); }
    if (mq.addEventListener) mq.addEventListener('change', handleMQ); else mq.addListener(handleMQ);
    document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') closeMenu(); });

    // ====== DemoCoreChat (post-hero) ======
    (function DemoCoreChat(){
      const slot = document.getElementById('coreDemoSlot'); if (!slot) return;
      const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const switcher = document.getElementById('coreSwitcher');
      const header = {
        icon: document.getElementById('coreIcon'),
        title: document.getElementById('coreTitle'),
        sub: document.getElementById('coreSub'),
        chip: document.getElementById('coreHeaderChip')
      };
      const chatWrap = document.getElementById('chatWrap');

      const CORES = ['oc','research','coach'];
      let i = 0; let timer = null; let paused = false;
      const dur = 7200; // ~7s

      const bubbleBase = 'w-fit max-w-[75%] rounded-2xl px-3.5 py-2.5 text-sm leading-relaxed shadow-[0_6px_18px_rgba(0,0,0,.08)]';

      const makeBubbles = (key)=>{
        switch(key){
          case 'research': return [
            { role:'user', text:'Compare studies on GLP‑1 and weight loss.' },
            { role:'ai', text:'Key findings across 4 peer‑reviewed papers. (1) … (2) …', cite:true }
          ];
          case 'coach': return [
            { role:'user', text:'Hold me to 90 minutes deep work.' },
            { role:'ai', text:'Timer set. I’ll check in at 30/60/90—stay locked in.' }
          ];
          case 'oc':
          default: return [
            { role:'user', text:'Summarize my meeting notes.' },
            { role:'ai', text:'Here’s a crisp 5‑bullet summary and next steps.' }
          ];
        }
      };

      function setHeader(key){
        header.chip.className = 'hidden text-[11px] px-2 py-1 rounded-full border font-medium';
        switch(key){
          case 'research':
            header.icon.innerHTML = '<i class="ph ph-flask"></i>';
            header.icon.className = 'h-7 w-7 rounded-xl bg-cyan-600 text-white flex items-center justify-center';
            header.title.textContent = 'OC‑Research‑Core';
            header.sub.textContent = 'Research';
            break;
          case 'coach':
            header.icon.innerHTML = '<i class="ph ph-compass-tool"></i>';
            header.icon.className = 'h-7 w-7 rounded-xl bg-amber-600 text-white flex items-center justify-center';
            header.title.textContent = 'OC‑Coach‑Core';
            header.sub.textContent = 'Coaching';
            header.chip.textContent = 'Check‑in';
            header.chip.className = 'text-[11px] px-2 py-1 rounded-full border font-medium border-amber-300/60 text-amber-800 bg-amber-50/70 dark:text-amber-200 dark:border-amber-400/30 dark:bg-amber-900/30';
            break;
          default:
            header.icon.innerHTML = '<i class="ph ph-cpu"></i>';
            header.icon.className = 'h-7 w-7 rounded-xl bg-neutral-900 text-white dark:bg-white dark:text-neutral-900 flex items-center justify-center';
            header.title.textContent = 'OC‑Core';
            header.sub.textContent = 'General';
        }
      }

      function bubbleEl(item, idx, theme){
        const isUser = item.role === 'user';
        const wrap = document.createElement('div');
        wrap.className = `flex ${isUser ? 'justify-end' : 'justify-start'} mt-2`;
        const bubble = document.createElement('div');
        bubble.className = `${bubbleBase} ${isUser ? 'bg-neutral-900 text-white dark:bg-white dark:text-neutral-900' : theme.aiBg}`;
        bubble.setAttribute('data-bubble','');
        bubble.textContent = item.text;
        if (!reduce) bubble.style.opacity = '0';
        // Optional micro adornments
        if (!isUser && item.cite){
          const dot = document.createElement('span'); dot.setAttribute('aria-hidden','true');
          dot.className = 'inline-flex items-center justify-center ml-1 -mr-1 align-middle';
          dot.innerHTML = '<i class="ph ph-dot text-cyan-600"></i>';
          bubble.appendChild(dot);
        }
        // OC-Core micro badge on assistant bubble
        if (!isUser && theme.k === 'oc'){
          const badge = document.createElement('span'); badge.setAttribute('aria-hidden','true');
          badge.className = 'inline-flex items-center justify-center ml-1 -mr-1 align-middle text-neutral-500';
          badge.innerHTML = '<i class="ph ph-circle-wavy-check"></i>';
          bubble.appendChild(badge);
        }
        wrap.appendChild(bubble);
        return wrap;
      }

      function themeFor(key){
        switch(key){
          case 'research': return { k:'research', aiBg: 'bg-cyan-50 text-neutral-900 border border-cyan-200/70 dark:bg-cyan-900/20 dark:text-white dark:border-cyan-400/20' };
          case 'coach': return { k:'coach', aiBg: 'bg-amber-50 text-neutral-900 border border-amber-200/70 dark:bg-amber-900/20 dark:text-white dark:border-amber-400/20' };
          default: return { k:'oc', aiBg: 'bg-neutral-100 text-neutral-900 border border-neutral-200/70 dark:bg-neutral-800/60 dark:text-white dark:border-neutral-600/40' };
        }
      }

      function animateIn(container){
        if (reduce) return;
        // Card in
        container.animate([
          { opacity: 0, transform: 'translateY(10px) scale(0.97)' },
          { opacity: 1, transform: 'translateY(0) scale(1)' }
        ], { duration: 230, easing: 'cubic-bezier(.22,.8,.22,1)' });
        // Bubble stagger
        const bubbles = container.querySelectorAll('[data-bubble]');
        bubbles.forEach((b, idx)=>{
          b.animate([
            { opacity: 0, transform: 'translateY(6px)' },
            { opacity: 1, transform: 'translateY(0)' }
          ], { duration: 200, delay: 50 + idx*60, easing: 'cubic-bezier(.22,.8,.22,1)', fill: 'both' });
        });
      }

      function render(key){
        setHeader(key);
        // Replace bubbles
        chatWrap.innerHTML = '';
        const t = themeFor(key);
        const items = makeBubbles(key);
        for (let idx=0; idx<items.length; idx++){
          chatWrap.appendChild(bubbleEl(items[idx], idx, t));
        }
        if (!reduce) animateIn(chatWrap);
      }

      function setActive(core){
        const pills = Array.from(switcher.querySelectorAll('[role="radio"]'));
        pills.forEach(btn=>{
          const active = btn.getAttribute('data-core')===core;
          btn.setAttribute('aria-checked', String(active));
          btn.classList.toggle('font-semibold', active);
          btn.classList.toggle('font-medium', !active);
          btn.classList.toggle('bg-neutral-900', active && btn.dataset.core==='oc');
          btn.classList.toggle('text-white', active && btn.dataset.core==='oc');
          btn.classList.toggle('bg-white', active && btn.dataset.core!=='oc');
          btn.classList.toggle('text-neutral-900', active && btn.dataset.core!=='oc');
          btn.classList.toggle('ring-1', active);
          btn.classList.toggle('ring-black/70', active);
          btn.classList.toggle('dark:ring-white/70', active);
        });
        render(core);
      }

      function next(){ i = (i+1)%CORES.length; setActive(CORES[i]); }
      function prev(){ i = (i-1+CORES.length)%CORES.length; setActive(CORES[i]); }

      // Events
      switcher.addEventListener('click', (e)=>{
        const btn = e.target.closest('[role="radio"]'); if (!btn) return;
        i = CORES.indexOf(btn.dataset.core); if (i<0) i=0;
        setActive(CORES[i]);
      });
      switcher.addEventListener('keydown', (e)=>{
        if (e.key==='ArrowRight') { next(); e.preventDefault(); }
        else if (e.key==='ArrowLeft') { prev(); e.preventDefault(); }
        else if (e.key==='Home') { i=0; setActive(CORES[i]); e.preventDefault(); }
        else if (e.key==='End') { i=CORES.length-1; setActive(CORES[i]); e.preventDefault(); }
      });

      function start(){ if (timer) clearInterval(timer); if (!reduce) timer = setInterval(()=>{ if (!paused) next(); }, dur); }
      function stop(){ if (timer) { clearInterval(timer); timer=null; } }
      const hoverables = [switcher, chatWrap];
      hoverables.forEach(el=>{
        el.addEventListener('mouseenter', ()=>{ paused = true; });
        el.addEventListener('mouseleave', ()=>{ paused = false; });
        el.addEventListener('focusin', ()=>{ paused = true; });
        el.addEventListener('focusout', ()=>{ paused = false; });
      });

      // Initial
      setActive(CORES[i]);
      start();
      document.addEventListener('visibilitychange', ()=>{ if (document.hidden) stop(); else start(); });
    })();

    // ====== Marketplace data (five cores only) ======
    const CORES = [
      { id:'oc', name:'OC‑Core', icon:'ph-cpu', tier:'standard', comingSoon:false, tags:['productivity','writing'], rating:4.9, installs:23542, version:'1.3.2', updated:'2025‑07‑22', size:'54 MB', short:'General reasoning, planning, and drafting — your default brain.', bullets:['Fast on‑device context & structured outputs','Writes briefs, emails, docs with export‑ready formatting','Private by design — no cloud send'], theme:'light' },
      { id:'ocpro', name:'OC‑Pro', icon:'ph-seal-check', tier:'pro', comingSoon:false, tags:['productivity','writing'], rating:4.9, installs:22103, version:'3.0.1', updated:'2025‑08‑12', size:'58 MB', short:'Crystal‑clear structure and language for briefs, memos, and decks.', bullets:['Structure detection & outline locks','Style harmonizer across sections','One‑click executive summary'], theme:'light' },
      { id:'ocresearch', name:'OC‑Research', icon:'ph-magnifying-glass', tier:'standard', comingSoon:false, tags:['research','education'], rating:4.8, installs:19210, version:'2.1.0', updated:'2025‑07‑01', size:'61 MB', short:'Verifiable research: crawl, rank, and synthesize with citations.', bullets:['Quote capture with line‑level references','Evidence ranking & conflict resolution','One‑tap audit trail to originals'], theme:'light' },
      { id:'occoach', name:'OC‑Coach', icon:'ph-compass-tool', tier:'pro', comingSoon:true, tags:['productivity','education'], rating:4.7, installs:15088, version:'1.6.0', updated:'2025‑06‑18', size:'42 MB', short:'Guided planning and execution with stepwise clarity.', bullets:['Goal setting, checkpoints, milestones','Reasoned coaching on craft & performance','From brief to ship with momentum'], theme:'light' },
      { id:'oclaw', name:'OC‑Law', icon:'ph-scales', tier:'pro', comingSoon:true, tags:['legal','writing'], rating:4.8, installs:11124, version:'0.9.5', updated:'2025‑07‑28', size:'48 MB', short:'Clause‑aware drafting, redlines, and issue spotting for agreements.', bullets:['Clause libraries with rationale','Risk flags & diff explainers','Export to Word/Pages templates'], theme:'light' },
      { id:'occhat', name:'OC‑Chat', icon:'ph-chat-circle-dots', tier:'standard', comingSoon:true, tags:['productivity','writing'], rating:4.6, installs:12044, version:'1.0.0', updated:'2025‑08‑25', size:'38 MB', short:'Fast, context‑aware chat with document memory and tone controls.', bullets:['Ambient memory per project','Inline tone + length tuning','One‑tap export to docs'], theme:'light' }
    ];

    // ====== State ======
    const state = {
      q:'', filter:'all', sort:'trending',
      installed: new Set(JSON.parse(localStorage.getItem('oc:installed')||'[]')),
      
      showInstalledOnly:false
    };

    // ====== DOM ======
    const proWrap = document.getElementById('proWrap');
    const stdWrap = document.getElementById('stdWrap');
    const proGrid = document.getElementById('proGrid');
    const stdGrid = document.getElementById('stdGrid');
    const proCount = document.getElementById('proCount');
    const stdCount = document.getElementById('stdCount');
    const resultsMeta = document.getElementById('resultsMeta');
    const emptyState = document.getElementById('emptyState');
    const resetFiltersBtn = document.getElementById('resetFiltersBtn');
    const searchEl = document.getElementById('marketSearch');
    const clearSearchBtn = document.getElementById('clearSearchBtn');
    const sortSelect = document.getElementById('sortSelect');
    const myGrid = document.getElementById('myCoresGrid');
    const myEmpty = document.getElementById('myCoresEmpty');
    const showInstalledToggle = document.getElementById('showInstalledToggle');

    // ====== Utils ======
    const fmt = new Intl.NumberFormat();
    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    function bySort(a,b){ switch(state.sort){ case 'rating': return (b.rating - a.rating) || (b.installs - a.installs); case 'newest': return (new Date(b.updated) - new Date(a.updated)); case 'installs': return (b.installs - a.installs); default: return (b.rating*100 + b.installs/100) - (a.rating*100 + a.installs/100);} }
    function matches(core){ if (state.showInstalledOnly && !state.installed.has(core.id)) return false; if (state.filter !== 'all' && !core.tags.includes(state.filter)) return false; if (!state.q) return true; const q = state.q.toLowerCase(); return [core.name, core.short, core.tags.join(' ')].join(' ').toLowerCase().includes(q); }
    function stars(r){ const n = Math.round(r*2)/2; let out=''; for(let i=1;i<=5;i++){ if(i<=Math.floor(n)) out += '<i class="ph ph-star-fill"></i>'; else if(i-0.5===n) out += '<i class="ph ph-star-half"></i>'; else out += '<i class="ph ph-star"></i>'; } return out; }
    const cap = (s)=> s.charAt(0).toUpperCase()+s.slice(1);

    // ====== Render card ======
    function card(core, opts={}){
      const dark = (!!opts.dark) || core.theme==='dark';
      const el = document.createElement('article');
      el.className = `reveal tilt rounded-2xl overflow-hidden ${dark?'card-dark':'card'} p-5 md:p-6 relative`;
      el.setAttribute('tabindex','0');
      el.setAttribute('role','button');
      el.dataset.coreId = core.id;
      const pillTier = `<span class=\"pill ${core.tier==='pro'?'pill-pro':''}\">${core.tier==='pro'?'Pro':'Standard'}</span>`;
      const pillSoon = core.comingSoon ? `<span class=\"pill pill-soon\">Coming soon</span>` : '';
      el.innerHTML = `
        <div class="flex items-start gap-3">
          <div class="flex items-center gap-3">
            <div class="h-10 w-10 shrink-0 rounded-2xl ${dark?'bg-white/10 border border-white/20 text-white':'bg-neutral-900/90 text-white'} flex items-center justify-center"><i class="ph ${core.icon} text-[18px]"></i></div>
            <div>
              <h3 class="text-[16px] md:text-[17px] font-semibold ${dark?'text-white':'text-neutral-900'}">${core.name}</h3>
            </div>
          </div>
        </div>
        <p class="mt-3 text-[14px] leading-relaxed ${dark?'text-white/90':'text-neutral-700'}">${core.short}</p>
        <div class="mt-4 flex items-center gap-2">
          ${pillTier}${pillSoon}
        </div>
        <div class="absolute inset-0 pointer-events-none sheen-sweep" style="animation-delay:${Math.random()*6}s"></div>`;
      return el;
    }

    // ====== Render grids ======
    function render(){
      const list = CORES.filter(matches);
      const pros = list.filter(c=> c.tier==='pro').sort(bySort);
      const stds = list.filter(c=> c.tier!=='pro').sort(bySort);

      // Pro group
      proGrid.innerHTML = '';
      pros.forEach(c=> proGrid.appendChild(card(c, { dark:true })));
      proWrap.classList.toggle('hidden', pros.length===0);
      if (proCount) { proCount.textContent = ''; proCount.classList.add('hidden'); }

      // Standard group
      stdGrid.innerHTML = '';
      stds.forEach(c=> stdGrid.appendChild(card(c, { dark:false })));
      stdWrap.classList.toggle('hidden', stds.length===0);
      if (stdCount) { stdCount.textContent = ''; stdCount.classList.add('hidden'); }

      const total = pros.length + stds.length;
      if (resultsMeta) { resultsMeta.textContent = ''; resultsMeta.classList.add('hidden'); }
      emptyState.classList.toggle('hidden', total>0);

      // My cores removed; keep compatibility if nodes exist
      if (myGrid) {
        const my = CORES.filter(c=> state.installed.has(c.id));
        myGrid.innerHTML = '';
        my.forEach(c=> myGrid.appendChild(card(c)));
        if (myEmpty) myEmpty.classList.toggle('hidden', my.length>0);
      }

      document.dispatchEvent(new Event('oc:market-render'));
    }

    // ====== Filters/Search/Sort wiring ======
    document.querySelectorAll('[data-filter]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('[data-filter]').forEach(b=>{ b.classList.remove('chip-on'); b.setAttribute('aria-pressed','false'); });
        btn.classList.add('chip-on');
        btn.setAttribute('aria-pressed','true');
        state.filter = btn.getAttribute('data-filter');
        render();
      });
    });
    searchEl?.addEventListener('input', ()=>{ state.q = searchEl.value.trim(); clearSearchBtn?.classList.toggle('hidden', !state.q); render(); });
    clearSearchBtn?.addEventListener('click', ()=>{ if (searchEl) searchEl.value=''; state.q=''; clearSearchBtn?.classList.add('hidden'); render(); });
    sortSelect?.addEventListener('change', ()=>{ state.sort = sortSelect.value; render(); });
    resetFiltersBtn?.addEventListener('click', ()=>{
      state.q=''; if (searchEl) searchEl.value=''; clearSearchBtn?.classList.add('hidden'); state.filter='all';
      document.querySelectorAll('[data-filter]').forEach(b=>{
        const on = b.getAttribute('data-filter')==='all';
        b.classList.toggle('chip-on', on);
        b.setAttribute('aria-pressed', on?'true':'false');
      });
      render();
    });
    showInstalledToggle?.addEventListener('click', ()=>{
      state.showInstalledOnly = !state.showInstalledOnly;
      const on = state.showInstalledOnly;
      showInstalledToggle?.classList.toggle('bg-neutral-900', on);
      showInstalledToggle?.classList.toggle('text-white', on);
      showInstalledToggle?.setAttribute('aria-pressed', on?'true':'false');
      render();
    });

    // ====== Delegated actions (favorite/open) ======
    document.addEventListener('click', (e)=>{
      const cardEl = e.target.closest('[data-core-id]');
      const openBtn = e.target.closest('[data-open-core]');
      if (openBtn){ openModal(openBtn.getAttribute('data-open-core')); return; }
      if (cardEl){ openModal(cardEl.dataset.coreId); }
    });

    // ====== Modal ======
    const modal = { root: document.getElementById('coreModal'), panel:null, scrim:null, active:false, core:null, lastFocus:null };
    modal.panel = modal.root.querySelector('.modal-panel');
    modal.scrim = modal.root.querySelector('.modal-scrim');
    const m = {
      icon: document.getElementById('mIcon'),
      title: document.getElementById('mTitle'),
      tags: document.getElementById('mTags'),
      banner: document.getElementById('mBanner'),
      desc: document.getElementById('mDesc'),
      bullets: document.getElementById('mBullets'),
      closeBtn: document.getElementById('closeModalBtn')
    };

    function openModal(id){
      const core = CORES.find(c=> c.id===id); if (!core) return;
      modal.core = core; modal.lastFocus = document.activeElement;
      m.icon.innerHTML = `<i class="ph ${core.icon}"></i>`;
      m.title.textContent = core.name;
      const tierPill = `<span class="pill ${core.tier==='pro'?'pill-pro':''}">${core.tier==='pro'?'Pro':'Standard'}</span>`;
      m.tags.innerHTML = tierPill + ' ' + core.tags.map(t=>`<span class="badge">${cap(t)}</span>`).join(' ');
      m.desc.textContent = core.short || `A ${core.tier==='pro'?'Pro‑grade':'standard'} core built for ${core.tags.join(', ')}.`;
      const __fallbackBullets = [
        'Fast, private, and local‑first by design',
        'Works offline; syncs when you want',
        'Seamless with your OC workspace'
      ];
      const __list = (core.bullets && core.bullets.length) ? core.bullets : __fallbackBullets;
      m.bullets.innerHTML = __list.map(b=>`<li class="flex gap-2"><i class="ph ph-check-circle text-neutral-900"></i><span>${b}</span></li>`).join('');
      // Left demo preview (Apple-like)
      m.banner.classList.toggle('g-grad', false);
      const demo = (()=>{
        switch(core.id){
          case 'occhat':
            return `
            <div class="demo">
              <div class="demo-card" role="img" aria-label="Animated chat preview">
                <div class="toolstrip">
                  <div class="tool active"><i class="ph ph-stethoscope"></i></div>
                  <div class="tool"><i class="ph ph-compass-tool"></i></div>
                  <div class="tool"><i class="ph ph-flask"></i></div>
                  <div class="tool"><i class="ph ph-brain"></i></div>
                </div>
                <div class="bubble">Can you summarize this brief for execs?</div>
                <div class="bubble me">Sure — 5 bullets and a one‑liner?</div>
                <div class="bubble">Perfect. Tone: clear and concise.</div>
              </div>
              ${core.comingSoon?'<span class="soon-badge">Coming soon</span>':''}
            </div>`;
          case 'ocresearch':
            return `
            <div class="demo">
              <div class="demo-card" role="img" aria-label="Research highlights preview">
                <div class="toolstrip">
                  <div class="tool active"><i class="ph ph-flask"></i></div>
                  <div class="tool"><i class="ph ph-notebook"></i></div>
                  <div class="tool"><i class="ph ph-magnifying-glass"></i></div>
                  <div class="tool"><i class="ph ph-brain"></i></div>
                </div>
                <div class="quote">“Revenue grew 12% YoY; guidance raised to 14–16%.”</div>
                <div class="quote">“Top three drivers: pricing power, LLM adoption, and retention.”</div>
                <div class="quote">“Key risk is margin compression on infra spend.”</div>
              </div>
            </div>`;
          case 'ocpro':
          case 'oc':
          case 'occoach':
            return `
            <div class="demo">
              <div class="demo-card" role="img" aria-label="Document structure preview">
                <div class="toolstrip">
                  <div class="tool active"><i class="ph ph-seal-check"></i></div>
                  <div class="tool"><i class="ph ph-pencil"></i></div>
                  <div class="tool"><i class="ph ph-text-aa"></i></div>
                  <div class="tool"><i class="ph ph-brain"></i></div>
                </div>
                <div class="demo-row"><div class="demo-bar l1 hl"></div></div>
                <div class="demo-row"><div class="demo-bar l3"></div></div>
                <div class="demo-row"><div class="demo-bar l2"></div></div>
                <div class="demo-row"><div class="demo-bar l4"></div></div>
                ${core.comingSoon?'<span class="soon-badge">Coming soon</span>':''}
              </div>
            </div>`;
          case 'oclaw':
            return `
            <div class="demo">
              <div class="demo-card" role="img" aria-label="Legal drafting preview">
                <div class="toolstrip">
                  <div class="tool active"><i class="ph ph-scales"></i></div>
                  <div class="tool"><i class="ph ph-file-text"></i></div>
                  <div class="tool"><i class="ph ph-bookmarks"></i></div>
                  <div class="tool"><i class="ph ph-brain"></i></div>
                </div>
                <div class="demo-row"><div class="demo-bar l2 hl"></div></div>
                <div class="demo-row"><div class="demo-bar l3"></div></div>
                <div class="demo-row"><div class="demo-bar l4"></div></div>
                <span class="soon-badge">Coming soon</span>
              </div>
            </div>`;
          default:
            return '<div class="demo"><div class="demo-card"></div></div>';
        }
      })();
      m.banner.innerHTML = demo;

      // Minimal modal: no install/download UI

      modal.root.classList.remove('hidden');
      modal.root.setAttribute('aria-hidden','false');
      requestAnimationFrame(()=>{ modal.root.classList.add('active'); modal.active = true; m.closeBtn.focus(); });
    }

    function closeModal(){ modal.root.classList.remove('active'); modal.active=false; setTimeout(()=>{ modal.root.classList.add('hidden'); modal.root.setAttribute('aria-hidden','true'); modal.core=null; if (modal.lastFocus) modal.lastFocus.focus(); }, 250); }

    m.closeBtn.addEventListener('click', closeModal);
    modal.scrim.addEventListener('click', closeModal);
    document.addEventListener('keydown', (e)=>{ if (e.key==='Escape' && modal.active) closeModal(); });
    // No install button in minimal modal

    // Basic focus trap
    modal.root.addEventListener('keydown', (e)=>{
      if (!modal.active || e.key!=='Tab') return;
      const f = modal.root.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
      const a = Array.from(f).filter(x=> !x.hasAttribute('disabled') && x.offsetParent!==null);
      const first = a[0], last = a[a.length-1];
      if (e.shiftKey && document.activeElement===first){ last.focus(); e.preventDefault(); }
      else if (!e.shiftKey && document.activeElement===last){ first.focus(); e.preventDefault(); }
    });

    // ====== Reveal observers ======
    const io = new IntersectionObserver((entries)=>{ for (const e of entries){ if (e.isIntersecting){ e.target.classList.add('in'); io.unobserve(e.target); } } }, { threshold:.25 });
    document.querySelectorAll('.reveal').forEach(el=> io.observe(el));
    document.addEventListener('oc:market-render', ()=>{
      document.querySelectorAll('#marketplace .reveal:not(.in)').forEach(el=> io.observe(el));
    });
    const io2 = new IntersectionObserver((entries)=>{ for (const e of entries){ if (e.isIntersecting){ e.target.classList.add('in-view'); io2.unobserve(e.target); } } }, { threshold:.25 });
    document.querySelectorAll('.scroll-fade').forEach(el=> io2.observe(el));

    // Marketplace FX: soft constellation behind grids
    (function marketFx(){
      const cvs = document.getElementById('marketFx'); if (!cvs) return;
      const ctx = cvs.getContext('2d', { alpha:true });
      let w=0,h=0, dpr=Math.min(2, window.devicePixelRatio||1);
      function resize(){ const wrap = document.getElementById('marketFxWrap'); if(!wrap) return; const r=wrap.getBoundingClientRect(); w=Math.floor(r.width); h=Math.floor(Math.max(180, r.height)); cvs.width=Math.floor(w*dpr); cvs.height=Math.floor(h*dpr); ctx.setTransform(dpr,0,0,dpr,0,0); }
      const reduce = matchMedia('(prefers-reduced-motion: reduce)').matches;
      resize();
      window.addEventListener('resize', resize);
      const N = 60; const nodes = Array.from({length:N}).map(()=>({ x:Math.random()*w, y:Math.random()*h, vx:(Math.random()-.5)*.25, vy:(Math.random()-.5)*.25, r: Math.random()*1.5+0.5, a: Math.random()*0.4+0.2 }));
      function step(){ ctx.clearRect(0,0,w,h); for(const n of nodes){ n.x+=n.vx; n.y+=n.vy; if(n.x<-10||n.x>w+10) n.vx*=-1; if(n.y<-10||n.y>h+10) n.vy*=-1; ctx.beginPath(); ctx.arc(n.x,n.y,n.r,0,Math.PI*2); ctx.fillStyle=`rgba(10,13,16,${n.a*.15})`; ctx.fill(); }
        for(let i=0;i<nodes.length;i++){ const a=nodes[i]; for(let j=i+1;j<i+8 && j<nodes.length;j++){ const b=nodes[j]; const dx=a.x-b.x, dy=a.y-b.y; const d=Math.hypot(dx,dy); if(d<120){ const alpha = (1 - d/120)*.08; ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.strokeStyle=`rgba(10,13,16,${alpha})`; ctx.lineWidth=1; ctx.stroke(); } } }
        if (!reduce) requestAnimationFrame(step);
      }
      if (!reduce) requestAnimationFrame(step);
    })();

    // Enhanced tilt on cards (subtle 3D)
    (function cardTilt(){ const cards = Array.from(document.querySelectorAll('#marketplace .tilt')); if(!cards.length) return; const reduce = matchMedia('(prefers-reduced-motion: reduce)').matches; if (reduce) return; const max=5; cards.forEach(c=>{ let raf=0; const onMove=(e)=>{ const r=c.getBoundingClientRect(); const x=e.clientX - r.left; const y=e.clientY - r.top; const rx=((y/r.height)-.5)*-max; const ry=((x/r.width)-.5)*max; cancelAnimationFrame(raf); raf=requestAnimationFrame(()=>{ c.style.transform=`perspective(800px) rotateX(${rx}deg) rotateY(${ry}deg) translateY(-2px)`; c.style.boxShadow=`0 22px 60px rgba(0,0,0,.18)`;});}; const reset=()=>{ cancelAnimationFrame(raf); c.style.transform=''; c.style.boxShadow='';}; c.addEventListener('mousemove',onMove); c.addEventListener('mouseleave',reset); }); })();

    // Initial render
    render();

    // Showcase scene cycle (hero)
    (function cycleScenes(){
      const root = document.querySelector('.showcase');
      if (!root) return;
      const scenes = Array.from(root.querySelectorAll('.scene'));
      if (!scenes.length) return;
      let i = 0; const dur = 4200; const fadeGap = 150;
      const setActive = (idx)=> scenes.forEach((s,j)=> s.classList.toggle('active', j===idx));
      setActive(0);
      const tick = ()=>{ i = (i+1) % scenes.length; setActive(i); timer = setTimeout(tick, dur); };
      let timer = setTimeout(tick, dur);
      // Pause on hover for desktop
      root.addEventListener('mouseenter', ()=>{ clearTimeout(timer); });
      root.addEventListener('mouseleave', ()=>{ clearTimeout(timer); timer = setTimeout(tick, fadeGap); });
    })();

    // ====== Hero spin cycle (one-by-one) ======
    (function heroScreenSaver(){
      const stage = document.querySelector('.ad-stage'); if (!stage) return;
      const reduce = matchMedia('(prefers-reduced-motion: reduce)').matches;
      if (reduce) return;

      // Disable CSS wrapper animations for full JS control
      stage.classList.add('js-physics');

      const cards = Array.from(stage.querySelectorAll('.ad-card'));
      if (!cards.length) return;

      const nodes = cards.map(el => ({ el, x: 0, y: 0, w: 0, h: 0, vx: 0, vy: 0, ang: 0, vang: 0 }));

      const rand = (a,b)=> Math.random()*(b-a)+a;

      let minX = 0;
      function measure(){
        const sr = stage.getBoundingClientRect();
        // Compute left guard so cards never overlap the left copy/buttons on desktop
        let guard = 0;
        try{
          const copy = document.querySelector('#home .text-left');
          if (copy) {
            const cr = copy.getBoundingClientRect();
            // Guard is the right edge of the copy relative to the stage, plus a small padding
            guard = Math.round((cr.right - sr.left) + 10);
            // Clamp guard to stage width bounds
            guard = Math.max(0, Math.min(sr.width - 20, guard));
            // On mobile (single column), allow free roam
            if (window.matchMedia('(max-width: 767px)').matches) guard = 0;
          }
        }catch(_){ guard = 0; }
        minX = guard;
        for (const n of nodes){
          const r = n.el.getBoundingClientRect();
          n.w = r.width; n.h = r.height;
          if (!n._init){
            n.x = rand(minX, Math.max(minX + 1, sr.width - n.w));
            n.y = rand(0, Math.max(1, sr.height - n.h));
            n.vx = rand(10, 24) * (Math.random()<.5? -1: 1); // px/s — slower
            n.vy = rand(10, 24) * (Math.random()<.5? -1: 1);
            n.ang = rand(-3, 3);
            n.vang = rand(-6, 6); // deg/s — gentler
            n._init = true;
          }
        }
        return { w: sr.width, h: sr.height };
      }

      let stageSize = measure();
      let last = performance.now();

      // Mobile hint for lighter frame pacing
      const mqMobile = window.matchMedia('(max-width: 767px)');
      let isMobile = mqMobile.matches;
      try { mqMobile.addEventListener('change', (e)=>{ isMobile = e.matches; }); } catch(_){}

      // Pause updates when hero not on screen
      let isVisible = true;
      try {
        const io = new IntersectionObserver((entries)=>{ if (entries && entries[0]) isVisible = entries[0].isIntersecting; }, { threshold: 0.01 });
        io.observe(stage);
      } catch(_){}

      function tick(now){
        // If hero is off-screen, skip heavy work
        if (!isVisible) { requestAnimationFrame(tick); return; }
        // On mobile, update at ~30fps by skipping frames
        if (isMobile && (now - last) < 33) { requestAnimationFrame(tick); return; }
        const dt = Math.min(0.035, (now - last)/1000); // clamp step to keep motion smooth
        last = now;
        const maxX = stageSize.w, maxY = stageSize.h;

        for (const n of nodes){
          // Update position
          n.x += n.vx * dt;
          n.y += n.vy * dt;

          // Bounce on walls with a tiny spin impulse
          if (n.x <= minX){ n.x = minX; n.vx = Math.abs(n.vx); n.vang += rand(-15, 15); }
          else if (n.x + n.w >= maxX){ n.x = maxX - n.w; n.vx = -Math.abs(n.vx); n.vang += rand(-15, 15); }

          if (n.y <= 0){ n.y = 0; n.vy = Math.abs(n.vy); n.vang += rand(-15, 15); }
          else if (n.y + n.h >= maxY){ n.y = maxY - n.h; n.vy = -Math.abs(n.vy); n.vang += rand(-15, 15); }

          // Angle update with gentle damping so it doesn't spin forever
          n.ang += n.vang * dt;
          n.vang *= 0.995; // stronger damping for slower spin
          // Occasional micro drift (desktop only to reduce mobile CPU/GPU churn)
          if (!isMobile && Math.random() < 0.004) n.vang += rand(-3, 3);
          if (!isMobile && Math.random() < 0.006) {
            n.vx += rand(-2, 2); n.vy += rand(-2, 2);
          }
          // Clamp speeds to a soft range; slightly lower caps on mobile
          const clampSpeed = (v)=> {
            const cap = isMobile ? 22 : 28;
            const min = 8;
            const base = (Math.abs(v) < min ? (v < 0 ? -min : min) : v);
            return Math.max(-cap, Math.min(cap, base));
          };
          n.vx = clampSpeed(n.vx); n.vy = clampSpeed(n.vy);

          n.el.style.transform = `translate3d(${n.x}px, ${n.y}px, 0) rotate(${n.ang}deg)`;
        }

        requestAnimationFrame(tick);
      }

      const ro = new ResizeObserver(()=>{ stageSize = measure(); });
      ro.observe(stage);
      requestAnimationFrame(tick);
    })();
  </script>
</body>
</html>
