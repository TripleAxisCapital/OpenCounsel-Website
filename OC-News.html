<!DOCTYPE html>
<html lang="en" class="scroll-smooth" data-theme="auto">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>OC-News — Apple-Clean Top Stories</title>
  <meta name="theme-color" content="#000000" />
  <link rel="icon" href="logo.svg" type="image/svg+xml" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['Inter','ui-sans-serif','system-ui','SF Pro Text','Segoe UI','Roboto','Apple Color Emoji','Helvetica Neue','Arial','Noto Color Emoji','sans-serif'] },
          boxShadow: { 'oc-soft': '0 8px 24px -10px rgba(0,0,0,0.35)' },
          keyframes: {
            'ticker': { '0%': { transform: 'translateX(0)' }, '100%': { transform: 'translateX(-50%)' } },
            'progress': { '0%': { transform: 'translateX(-100%)' }, '100%': { transform: 'translateX(100%)' } },
            'fade-in': { '0%': { opacity: 0 }, '100%': { opacity: 1 } },
            'fade-out': { '0%': { opacity: 1 }, '100%': { opacity: 0 } }
          },
          animation: {
            'ticker': 'ticker 18s linear infinite',
            'progress': 'progress 1.1s ease-in-out infinite',
            'fade-in': 'fade-in .45s ease forwards',
            'fade-out': 'fade-out .45s ease forwards'
          }
        }
      }
    }
  </script>
  <style>
    :root{
      --radius:14px;
      --bg:#0b0b0c;--surface:#000000;--border:rgba(255,255,255,0.12);
      --text:#f5f7fb;--sub:#a6acb8;--accent:#356dff;--live:#ff3b30;
      --chip:rgba(255,255,255,0.06);--chip-border:rgba(255,255,255,0.12);
      --card-hover:rgba(255,255,255,0.06);
      --header-h:60px;
      --preload-bg:#ffffff; --preload-text:#000000;
    }
    html.light{
      --bg:#ffffff;--surface:#ffffff;--border:rgba(5,13,38,0.10);
      --text:#0b0b0e;--sub:#5a6274;--accent:#356dff;
      --chip:rgba(0,0,0,0.035);--chip-border:rgba(0,0,0,0.08);
      --card-hover:rgba(0,0,0,0.045);
    }
    body{ background:var(--bg); color:var(--text) }

    /* Apple-clean primitives */
    .card{ background:var(--surface); border:1px solid var(--border); border-radius:var(--radius) }
    .chip{ background:var(--chip); border:1px solid var(--chip-border); border-radius:999px }
    .hairline{ height:1px; background:var(--border) }
    .link-btn{ border:0; background:transparent; padding:6px 8px; font-size:.875rem; color:var(--sub); display:inline-flex; gap:8px; border-radius:8px }
    .link-btn:hover{ color:var(--text) }
    /* remove outlines on interactive chrome */
    button,select,input{ outline:0 !important; box-shadow:none !important; }

    /* Section heads */
    .big-date{ font-weight:800; letter-spacing:-0.02em; font-size:clamp(24px,6vw,36px); color:var(--sub) }
    .brand-news{ font-weight:800; letter-spacing:-0.02em; font-size:clamp(28px,8vw,48px) }

    /* HERO */
    .hero-section-container{ padding-block:1.1rem }
    @media (min-width:640px){ .hero-section-container{ padding-block:1.6rem } }
    #heroCard{ min-height:58svh; overflow:hidden } /* rounded always */
    .hero-media{ position:relative; border-radius:calc(var(--radius) - 2px); overflow:hidden; border:1px solid var(--border); min-height:46svh; }
    .hero-track{ display:flex; height:100%; overflow-x:auto; scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch; }
    .hero-slide{ position:relative; flex:0 0 100%; width:100%; height:100%; scroll-snap-align:center }
    .hero-slide a{ position:absolute; inset:0; display:block }
    .hero-slide img{ width:100%; height:100%; object-fit:cover; display:block }
    .hero-overlay-text{
      position:absolute; inset-inline:16px; bottom:14px; display:grid; gap:6px; pointer-events:none; z-index:2;
    }
    .hero-glass{
      display:inline-block; max-width:min(92%, 860px); padding:10px 12px; border-radius:14px; color:#fff;
      background:linear-gradient(180deg, rgba(0,0,0,.45), rgba(0,0,0,.55));
      backdrop-filter: blur(10px) saturate(1.15); -webkit-backdrop-filter: blur(10px) saturate(1.15);
      border:1px solid rgba(255,255,255,.14);
      text-shadow: 0 2px 14px rgba(0,0,0,.45);
    }
    .hero-overlay-text .k{ font-size:10px; letter-spacing:.08em; text-transform:uppercase; opacity:.9; color:#fff }
    .hero-overlay-text h2{ font-size:clamp(18px, 3.4vw, 28px); line-height:1.12; font-weight:800; color:#fff; letter-spacing:-.015em }
    .hero-dots{
      position:absolute; bottom:12px; left:50%; transform:translateX(-50%);
      display:flex; gap:10px; z-index:3; pointer-events:none;
    }
    .hero-dots span{
      height:4px; width:10px; border-radius:999px;
      background:rgba(255,255,255,.45); border:1px solid rgba(255,255,255,.25);
      transition:width .25s ease;
    }
    .hero-dots span.active{ width:18px; background:#fff }
    html.light .hero-dots span{ background:rgba(0,0,0,.30); border-color:rgba(0,0,0,.18) }
    html.light .hero-dots span.active{ background:#000 }

    /* Images inside tiles */
    .tile-img{ width:100%; object-fit:cover; border:1px solid var(--border); border-radius:12px }

    /* Search sheet */
    #searchSheet{ position:fixed; inset-inline:0; top:var(--header-h); z-index:50; border-bottom:1px solid var(--border); background:color-mix(in oklab, var(--surface) 92%, transparent); backdrop-filter: blur(14px) }
    .search-field{ width:100%; border:0; border-radius:12px; background:transparent; padding:10px 36px 10px 34px; font-size:14px }
    .search-icon{ position:absolute; left:12px; top:50%; transform:translateY(-50%); opacity:.7 }
    .search-kbd{ position:absolute; right:10px; top:50%; transform:translateY(-50%); font-size:10px; color:var(--sub) }

    /* Preloader */
    #preload{ position:fixed; inset:0; z-index:70; display:grid; place-items:center; background:var(--preload-bg) }
    body.preloading{ overflow:hidden }
    .preload-wrap{ display:grid; gap:14px; place-items:center; text-align:center; padding:24px; color:var(--preload-text) }
    .preload-spinner{ width:28px; height:28px; border-radius:999px; border:2px solid rgba(0,0,0,.15); border-top-color:#000; animation:spin 1s linear infinite }
    @keyframes spin{ to{ transform:rotate(360deg) } }
  </style>
</head>
<body class="antialiased selection:bg-[var(--accent)]/20 selection:text-[var(--text)] preloading">
  <!-- Preloader -->
  <div id="preload" aria-live="polite" aria-busy="true">
    <div class="preload-wrap">
      <div class="preload-spinner"></div>
      <div id="preloadLine" style="font-weight:700; font-size:1.25rem; letter-spacing:-0.01em; margin-top:32px;">OC-News</div>
    </div>
  </div>

  <!-- Top loader -->
  <div id="topLoader" class="fixed inset-x-0 top-0 h-[2px] overflow-hidden z-[60] hidden">
    <div class="h-full w-1/3 bg-[var(--accent)] animate-progress"></div>
  </div>

  <!-- Header (minimal) -->
  <header class="border-b border-[var(--border)] bg-[var(--surface)] sticky top-0 z-40">
    <div class="mx-auto max-w-7xl px-3 sm:px-6 lg:px-8 py-2">
      <div class="flex items-center gap-2 sm:gap-3 justify-between">
        <div class="flex items-center gap-2 min-w-0">
          <img src="logo.svg" alt="OC" class="h-9 sm:h-10 dark:invert" />
          <div class="hidden sm:block text-sm text-[var(--sub)] truncate">The AI Workspace. Without Limits.</div>
        </div>
        <div class="flex items-center gap-1 sm:gap-2">
          <button id="searchToggle" class="link-btn" title="Search (/)">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="11" cy="11" r="7"/><path d="M21 21l-4.3-4.3"/></svg>
          </button>
          <button id="themeBtn" class="link-btn" title="Toggle theme (T)">
            <svg id="sun" class="size-4 hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="4" /><path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2m16 0h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"/></svg>
            <svg id="moon" class="size-4 hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 12.79A9 9 0 1111.21 3a7 7 0 009.79 9.79z"/></svg>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Search sheet -->
  <div id="searchSheet" class="hidden">
    <div class="mx-auto max-w-7xl px-3 sm:px-6 lg:px-8 py-3">
      <div class="relative">
        <span class="search-icon">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="11" cy="11" r="7"/><path d="M21 21l-4.3-4.3"/></svg>
        </span>
        <input id="searchField" class="search-field" placeholder="Search headlines…" autocomplete="off" />
        <kbd class="search-kbd">Esc</kbd>
      </div>
    </div>
  </div>

  <!-- MAIN -->
  <main id="newsMain">
    <!-- Header like Apple News: brand + date -->
    <section>
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 pt-4">
        <div class="flex items-center justify-between">
          <div class="brand-news">News</div>
          <div id="todayTag" class="big-date">—</div>
        </div>
      </div>
    </section>

    <!-- HERO -->
    <section class="relative">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 hero-section-container">
        <h2 class="sr-only">Top Stories</h2>

        <div id="heroCard" class="card shadow-oc-soft p-0 relative overflow-hidden">
          <figure id="heroMedia" class="hero-media">
            <div id="heroTrack" class="hero-track no-scrollbar"><!-- Slides injected --></div>
            <div id="heroDots" class="hero-dots"></div>
          </figure>

          <div class="px-4 sm:px-0">
            <div class="mt-3 sm:mt-4 flex items-center gap-3">
              <span id="updatedAt" class="ml-auto text-xs text-[var(--sub)]">—</span>
            </div>
            <div id="tickerWrap" class="mt-4 sm:mt-6 overflow-hidden">
              <div id="ticker" class="flex gap-2 min-w-[200%] whitespace-nowrap animate-ticker will-change-transform"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- FEED -->
    <section class="relative">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 pt-4 pb-2">
        <!-- IMPORTANT: 2 columns by default so first two tiles sit side-by-side on phones -->
        <ul id="newsList" class="grid grid-cols-2 gap-3 sm:gap-4 auto-rows-auto"></ul>
      </div>
      <div class="hairline"></div>
    </section>
  </main>

  <script>
    /* ===== CONFIG ===== */
    const DEFAULT_EDITION = 'CA';
    const MAX_ITEMS = 48;
    const SHOW_IMAGES = true;
    const HERO_SLIDES = 8;
    const DOT_COUNT = 6;

    /* ===== FEEDS (kept compact for clarity) ===== */
    const FEEDS = {
      CA: [
        'https://news.google.com/rss?hl=en-CA&gl=CA&ceid=CA:en',
        'https://feeds.bbci.co.uk/news/rss.xml',
        'https://feeds.reuters.com/reuters/topNews',
        'https://feeds.reuters.com/reuters/worldNews',
        'https://rss.cnn.com/rss/cnn_topstories.rss',
        'https://www.cbc.ca/cmlink/rss-topstories',
        'https://www.ctvnews.ca/rss/ctvnews-ca-top-stories-public-rss-1.822009',
        'https://globalnews.ca/feed/'
      ]
    };
    const feedsFor = (ed)=> FEEDS[ed] || FEEDS.CA;

    /* ===== UTILITIES ===== */
    const $ = (sel)=>document.querySelector(sel);
    const $$ = (sel)=>Array.from(document.querySelectorAll(sel));
    const hostname = (url)=>{ try{ return new URL(url).hostname.replace(/^www\./,'') } catch{ return '' } };
    const cleanLink=(url)=>{ try{ const u=new URL(url); const wrapped=u.searchParams.get('url')||u.searchParams.get('u'); return wrapped?decodeURIComponent(wrapped):url; }catch{ return url } };
    const normalizeTitle = (t)=> t.toLowerCase().replace(/[\W_]+/g,' ').trim();
    const timeAgo = (d)=>{
      const now = new Date();
      const diff = Math.max(0, now - d);
      const sec = Math.floor(diff/1000);
      if (sec<45) return `${sec}s ago`;
      const min = Math.floor(sec/60);
      if (min<60) return `${min}m ago`;
      const hr = Math.floor(min/60);
      if (hr<24) return `${hr}h ago`;
      const day = Math.floor(hr/24);
      return `${day}d ago`;
    };
    const upscale = (u)=>{ try{ const url=new URL(u); ['w','width','maxwidth','px','imgw'].forEach(k=>url.searchParams.has(k)&&url.searchParams.set(k,'1600')); return url.toString(); }catch{ return u } };

    const proxyCandidates = (url)=> ([
      `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
      `https://r.jina.ai/http/${url.replace(/^https?:\/\//,'')}`
    ]);
    const fetchWithProxies = async (url)=>{
      for (const prox of proxyCandidates(url)){
        try{
          const res = await fetch(prox, { cache: 'no-store' });
          if(!res.ok) continue;
          const text = await res.text();
          if(text && text.length > 40) return text;
        }catch(_){ }
      }
      throw new Error('All proxies failed: ' + url);
    };

    /* ===== RSS PARSER ===== */
    const parseRSS = (text)=>{
      const dom = new DOMParser().parseFromString(text, 'text/xml');
      const items = [];
      dom.querySelectorAll('item').forEach(it=>{
        const title = it.querySelector('title')?.textContent || '';
        let link = it.querySelector('link')?.textContent || '';
        link = cleanLink(link);
        const pub  = it.querySelector('pubDate')?.textContent || '';
        const src  = it.querySelector('source')?.textContent || hostname(link);
        const img1 = it.querySelector('media\\:content')?.getAttribute('url');
        const img2 = it.querySelector('enclosure')?.getAttribute('url');
        items.push({ title, link, pubDate: pub ? new Date(pub) : new Date(), source: src, image: img1 || img2 || '' });
      });
      return items;
    };

    /* ===== RENDER TARGETS ===== */
    const heroTrack = $('#heroTrack'); const heroDots = $('#heroDots'); const newsList = $('#newsList'); const ticker = $('#ticker'); const updatedAt = $('#updatedAt');

    /* ===== HERO BUILD ===== */
    const buildHeroSlides = (items)=>{
      const list = items.slice(0, Math.min(HERO_SLIDES, items.length));
      heroTrack.innerHTML = list.map((it, idx)=>{
        const src  = (SHOW_IMAGES && it.image) ? upscale(it.image) : '';
        const label= it.source || hostname(it.link);
        const safeTitle = it.title.replace(/</g,'&lt;').replace(/>/g,'&gt;');
        return `
          <div class="hero-slide" data-index="${idx}">
            <a href="${it.link}" target="_blank" rel="noopener" aria-label="${safeTitle}"></a>
            ${src ? `<img ${idx===0?'fetchpriority="high" loading="eager"':'loading="lazy"'} decoding="async" src="${src}" alt="${label}">` : ''}
            <div class="hero-overlay-text">
              <div class="hero-glass">
                <div class="k">${label} • ${timeAgo(it.pubDate)}</div>
                <h2>${safeTitle}</h2>
              </div>
            </div>
          </div>
        `;
      }).join('');
      const dcount = Math.min(DOT_COUNT, Math.max(1, list.length));
      heroDots.innerHTML = Array.from({ length: dcount }).map((_,i)=>`<span class="${i===0?'active':''}"></span>`).join('');
    };

    const renderTicker = (items)=>{
      const chips = (items.slice(0, 24).map(it=>{
        const src = it.source || hostname(it.link) || 'Source';
        const safe = it.title.replace(/</g,'&lt;').replace(/>/g,'&gt;');
        return `<span class="chip px-2.5 py-1 text-[11px] mr-2">${src}: ${safe}</span>`;
      }).join('')) || '';
      ticker.innerHTML = chips + chips;
    };

    /* ===== FEED RENDER (cards) ===== */
    const renderFeed = (items)=>{
      const tiles = items.slice(1, 20);
      let html = '';

      tiles.forEach((it, idx)=>{
        const src = it.source || hostname(it.link) || 'Source';
        const when = timeAgo(it.pubDate);
        const safeTitle = it.title.replace(/</g,'&lt;').replace(/>/g,'&gt;');
        const imgSrc = (SHOW_IMAGES && it.image) ? upscale(it.image) : '';

        if (idx < 2){
          /* Two tall vertical cards (side-by-side on mobile because grid is 2 cols) */
          html += `
            <li class="col-span-1">
              <article class="card overflow-hidden">
                ${imgSrc ? `<a href="${it.link}" target="_blank" rel="noopener" class="block"><img src="${imgSrc}" alt="" class="tile-img w-full h-[300px] sm:h-[360px] object-cover"></a>` : ``}
                <div class="p-3 sm:p-4">
                  <div class="flex items-center justify-between gap-3 text-[11px] text-[var(--sub)] mb-1">
                    <span>${src}</span><span>${when}</span>
                  </div>
                  <a href="${it.link}" target="_blank" rel="noopener" class="block">
                    <h3 class="text-base sm:text-lg font-extrabold leading-snug">${safeTitle}</h3>
                  </a>
                </div>
              </article>
            </li>
          `;
        } else {
          /* Horizontal full-width cards (image right) */
          html += `
            <li class="col-span-2">
              <article class="card p-3 sm:p-4 flex items-stretch gap-3 sm:gap-4">
                <div class="flex-1 min-w-0">
                  <div class="flex items-center justify-between gap-3 text-[11px] text-[var(--sub)] mb-1">
                    <span>${src}</span><span>${when}</span>
                  </div>
                  <a href="${it.link}" target="_blank" rel="noopener" class="block">
                    <h3 class="text-[17px] sm:text-xl font-extrabold leading-snug">${safeTitle}</h3>
                  </a>
                </div>
                ${imgSrc ? `
                  <a href="${it.link}" target="_blank" rel="noopener" class="shrink-0 w-[44%] sm:w-[300px] aspect-[16/10] rounded-xl overflow-hidden border border-[var(--border)]">
                    <img src="${imgSrc}" alt="" class="w-full h-full object-cover">
                  </a>` : ``}
              </article>
            </li>
          `;
        }
      });

      newsList.innerHTML = html;
    };

    /* ===== FEED LOADER ===== */
    const loadFeeds = async (editionKey)=>{
      const feeds = feedsFor(editionKey);
      const all = [];
      await Promise.allSettled(
        feeds.map(async (f)=>{
          try{
            const text = await fetchWithProxies(f);
            const items = parseRSS(text);
            all.push(...items);
          }catch(_){ }
        })
      );
      const seen = new Map(); // normTitle -> { item, count }
      for(const it of all){
        const key = normalizeTitle(it.title);
        if(!key) continue;
        const prev = seen.get(key);
        if(!prev){ seen.set(key, { item: it, count: 1 }); }
        else{
          if (it.pubDate && prev.item.pubDate && it.pubDate > prev.item.pubDate) prev.item = it;
          prev.count++;
        }
      }
      let uniq = Array.from(seen.values()).map(({item, count})=> ({...item, trendCount: count}));
      const now = Date.now();
      uniq.forEach(u=>{
        const ageMin = Math.max(1, (now - (u.pubDate?.getTime?.()||now))/60000);
        u._score = (u.trendCount||1) * (1/ageMin);
        if (u.image) u.image = upscale(u.image);
      });
      uniq.sort((a,b)=> (b._score - a._score) || ((b.pubDate||0) - (a.pubDate||0)));
      return uniq.slice(0, MAX_ITEMS);
    };

    /* ===== APP BOOT ===== */
    const THEME_KEY='oc_theme';
    const resolveAuto=()=> window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches ? 'light':'dark';
    const setTheme=(mode)=>{
      document.documentElement.dataset.theme = mode;
      const final = (mode==='auto')?resolveAuto():mode;
      document.documentElement.classList.toggle('light', final==='light');
      document.documentElement.classList.toggle('dark',  final==='dark');
      localStorage.setItem(THEME_KEY, mode);
      document.getElementById('sun').classList.toggle('hidden', final!=='light');
      document.getElementById('moon').classList.toggle('hidden', final!=='dark');
    };
    document.getElementById('themeBtn').addEventListener('click', ()=>{
      const cur = localStorage.getItem(THEME_KEY) || 'auto';
      const next = cur==='auto' ? 'dark' : (cur==='dark' ? 'light' : 'auto');
      setTheme(next);
    });

    const searchToggle = $('#searchToggle');
    const searchSheet  = $('#searchSheet');
    const searchField  = $('#searchField');
    let isSearchOpen = false;
    function openSearch(){ if(isSearchOpen) return; searchSheet.classList.remove('hidden'); isSearchOpen=true; setTimeout(()=>searchField.focus(),0); }
    function closeSearch(){ if(!isSearchOpen) return; searchSheet.classList.add('hidden'); isSearchOpen=false; }
    searchToggle.addEventListener('click', ()=> isSearchOpen?closeSearch():openSearch());
    window.addEventListener('keydown', (e)=>{
      if (e.key==='/' && !isSearchOpen){ e.preventDefault(); openSearch(); }
      if (e.key==='Escape'){ closeSearch(); }
    });
    searchField.addEventListener('input', (e)=>{
      const q=(e.target.value||'').toLowerCase().trim();
      const base = window.__cacheItems || [];
      const filtered = !q ? base : base.filter(it => it.title?.toLowerCase().includes(q) || (it.source||'').toLowerCase().includes(q) || hostname(it.link).includes(q));
      paint(filtered);
    });

    const todayTag = document.getElementById('todayTag');
    const formatAppleDate = (d)=>{
      const opts={ month:'long', day:'numeric' };
      return new Intl.DateTimeFormat(undefined, opts).format(d);
    };
    todayTag.textContent = formatAppleDate(new Date());

    const buildHero = (items)=>{
      buildHeroSlides(items);
      updatedAt.textContent = `Updated ${new Date().toLocaleTimeString([], { hour:'2-digit', minute:'2-digit' })}`;
      renderTicker(items);
    };

    const paint = (items)=>{
      if(!items.length){ heroTrack.innerHTML=''; heroDots.innerHTML=''; newsList.innerHTML=''; return; }
      buildHero(items);
      renderFeed(items);
    };

    const boot = async ()=>{
      try{
        setTheme(localStorage.getItem(THEME_KEY) || 'auto');
        const items = await loadFeeds(DEFAULT_EDITION);
        window.__cacheItems = items;
        paint(items);
      }catch(e){ console.error(e); }
      finally{
        const pre = document.getElementById('preload');
        if (pre) pre.style.display = 'none';
        document.body.classList.remove('preloading');
      }
    };

    // hero dots tracking
    heroTrack.addEventListener('scroll', ()=>{
      const slides = Array.from(heroTrack.children);
      let bestIdx = 0, bestDist = Infinity;
      const viewportCenter = heroTrack.getBoundingClientRect().left + heroTrack.clientWidth / 2;
      slides.forEach((el,i)=>{
        const rect = el.getBoundingClientRect();
        const slideCenter = rect.left + rect.width/2;
        const dist = Math.abs(slideCenter - viewportCenter);
        if (dist < bestDist){ bestDist = dist; bestIdx = i; }
      });
      const children = Array.from(heroDots.children);
      children.forEach((d,i)=>d.classList.toggle('active', i===bestIdx % Math.max(1, children.length)));
    }, { passive:true });

    // go
    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', boot);
    else boot();
  </script>
</body>
</html>
